<!-- Generated by SpecStory -->

# Improving Test Efficiency Plan (2025-05-01 16:45:55)

_**User**_

Please execute this plan.

Verify each step with `pnpm test && pnpm verify`
After each step, commit with a fix/feat message
Once complete, push

Please note that the main goal here is just to make the tests faster and the tests all currently pass locally and on the CI.

---

_**Assistant**_



---

Okay, I will execute the plan outlined in `.cursor/plans/test-speed.md` to optimize the integration tests. I'll verify each step and commit the changes.

**Step 1: Introduce "fast mode"**

First, I'll read the contents of `src/constants.ts` to apply the necessary modifications.

---

Read file: src/constants.ts

---

Now I'll modify `src/constants.ts` to include the "fast mode" logic.

---

```diff
  // src/constants.ts
  import packageInfo from "../package.json" with { type: "json" };
+ 
+ const FAST = process.env.MCP_PM_FAST === '1';
+ function ms(normal: number, fast: number): number { return FAST ? fast : normal; }
  
  /** Maximum number of log lines to store in memory per process. */
```

```diff
  
  /** Duration (ms) to wait for graceful process termination before forcing kill. */
- export const STOP_WAIT_DURATION = 3000;
+ export const STOP_WAIT_DURATION = ms(3000, 150);
  
  /** Interval (ms) for checking if a process has become a zombie (no longer responding). */
- export const ZOMBIE_CHECK_INTERVAL = 15000;
+ export const ZOMBIE_CHECK_INTERVAL = ms(15000, 500); // Reduced for faster test feedback
  
  /** Internal server name identifier. */
```

```diff
  
  /** Default delay (ms) before restarting a crashed process if retry_delay_ms is unspecified. */
- export const DEFAULT_RETRY_DELAY_MS = 1000;
+ export const DEFAULT_RETRY_DELAY_MS = ms(1000, 50);
  
  /** Interval (ms) for the zombie process check timer. */
- export const ZOMBIE_CHECK_INTERVAL_MS = 60000; // 1 minute
+ export const ZOMBIE_CHECK_INTERVAL_MS = ms(60000, 0); // Disable in fast mode
  
  // Constants for start_process log settling
  /** Duration (ms) of inactivity in logs required to consider the process startup settled. */
- export const LOG_SETTLE_DURATION_MS = 2000;
+ export const LOG_SETTLE_DURATION_MS = ms(2000, 75);
  
  /** Maximum time (ms) to wait for log settling before considering startup complete or failed. */
- export const OVERALL_LOG_WAIT_TIMEOUT_MS = 15000;
+ export const OVERALL_LOG_WAIT_TIMEOUT_MS = ms(15000, 500);
  
```

---

Now I need to find where the server process is spawned in the tests and modify it to set `MCP_PM_FAST=1`. I'll search for `spawn(` in the `tests/integration` directory.

---

<details>
            <summary>Grep search for "spawn\(" • **1** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/johnlindquist/dev/mcp-dev-server/tests/integration/mcp-server.test.ts` | L72 | `serverProcess = spawn(` |

</details>

---

Okay, the server is spawned in `tests/integration/mcp-server.test.ts`. I'll read this file to see the context.

---

Read file: tests/integration/mcp-server.test.ts

---

Now I'll edit `tests/integration/mcp-server.test.ts` to add the `MCP_PM_FAST=1` environment variable to the `spawn` call.

---

```diff
  			{
  				stdio: ["pipe", "pipe", "pipe"], // pipe stdin, stdout, stderr
- 				env: { ...process.env }, // Pass environment variables
+ 				env: { ...process.env, MCP_PM_FAST: '1' }, // Pass environment variables + FAST mode
  				// cwd: path.dirname(SERVER_SCRIPT_PATH), // Usually not needed if script path is absolute
  			},
```

---

I also need to add the `WAIT_DURATION_MS` constant to `src/constants.ts` as mentioned in the plan, as it's used in `src/toolImplementations.ts` according to the plan, but wasn't in the initial file read. Let's add it now.

---

```diff
  /** Maximum time (ms) to wait for log settling before considering startup complete or failed. */
  export const OVERALL_LOG_WAIT_TIMEOUT_MS = ms(15000, 500);
+ 
+ /** Default wait duration (ms) used in checkProcessStatusImpl. */
+ export const WAIT_DURATION_MS = ms(2000, 50);
  
```

---

Now I will run the verification command.

---

```bash
pnpm test && pnpm verify | cat
```

```

> mcp-pm@0.0.0-placeholder test /Users/johnlindquist/dev/mcp-dev-server
> vitest run


 RUN  v3.1.2 /Users/johnlindquist/dev/mcp-dev-server

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[TEST] BeforeAll: Setting up server...
[TEST] Spawning MCP server: node /Users/johnlindquist/dev/mcp-dev-server/build/i
ndex.mjs 
[TEST] Server process spawned with PID: 24151
[TEST] Waiting for server ready promise...

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [MCP-TEST-LOG STEP 1.1] Server main.ts started at: 2025-05-
01T22:50:54.638Z

[Server STDERR]: [MCP-TEST-LOG STEP 1.1] Server main.ts started at: 2025-05-01T2
2:50:54.638Z

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm] INFO: MCP Process Manager Tool running... 
[mcp-pm] INFO: Version: 0.0.0-placeholder 
[mcp-pm] INFO: [Diag] os.tmpdir() returned: /var/folders/c3/r013q3_93_s4zycmx0md
nt2h0000gn/T 
[mcp-pm] INFO: [Diag] Log directory name component: mcp-pm-logs-24151 
[mcp-pm] INFO: [Diag] path.join result: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h
0000gn/T/mcp-pm-logs-24151 

[Server STDERR]: [mcp-pm] INFO: MCP Process Manager Tool running... 
[mcp-pm] INFO: Version: 0.0.0-placeholder 
[mcp-pm] INFO: [Diag] os.tmpdir() returned: /var/folders/c3/r013q3_93_s4zycmx0md
nt2h0000gn/T 
[mcp-pm] INFO: [Diag] Log directory name component: mcp-pm-logs-24151 
[mcp-pm] INFO: [Diag] path.join result: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h
0000gn/T/mcp-pm-logs-24151

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm] INFO: Created log directory: /var/folders/c3/r013q
3_93_s4zycmx0mdnt2h0000gn/T/
mcp-pm-logs-24151
                            
[Server STDERR]: [mcp-pm] INFO: Created log directory: /var/folders/c3/r013q3_93
_s4zycmx0mdnt2h0000gn/T/mcp-
pm-logs-24151
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm] INFO: Tool definitions registered. 

[Server STDERR]: [mcp-pm] INFO: Tool definitions registered.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm] INFO: Setting zombie process check interval to 600
00ms. 

[Server STDERR]: [mcp-pm] INFO: Setting zombie process check interval to 60000ms
.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[TEST] MCP server ready signal detected in stderr.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm] INFO: MCP Server connected and listening via stdio
. 

[Server STDERR]: [mcp-pm] INFO: MCP Server connected and listening via stdio.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[TEST] Server startup successful.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[TEST] Short delay after server ready signal completed.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 zero processes initially
                            [TEST][listEmpty] Starting test...
[TEST][listEmpty] Sending list_processes request...
[sendRequest] Sending request (ID req-list-empty-1): {"jsonrpc":"2.0","method":"
tools/call","params":{"name"
:"list_processes","arguments":{"log_lines":0}},"id":"req-list-empty-1"}
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 zero processes initially
                            [Server STDERR RAW]: [mcp-pm] INFO: Tool invoked: li
st_processes { params: { log_lines: 0 } }

[Server STDERR]: [mcp-pm] INFO: Tool invoked: list_processes { params: { log_lin
es: 0 } }
[sendRequest][Server STDERR during request req-list-empty-1]: [mcp-pm] INFO: Too
l invoked: list_processes { 
params: { log_lines: 0 } }
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 zero processes initially
                            [Server STDERR RAW]: [mcp-pm] INFO: Tool successful:
 list_processes { responseSummary: '{\n  "processList": 
[]\n}...' }
                            
[Server STDERR]: [mcp-pm] INFO: Tool successful: list_processes { responseSummar
y: '{\n  "processList": []\n
}...' }
                            [sendRequest][Server STDERR during request req-list-
empty-1]: [mcp-pm] INFO: Tool successful: list_processes
 { responseSummary: '{\n  "processList": []\n}...' }
                            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 zero processes initially
                            [sendRequest] Received matching response for ID req-
list-empty-1: {"result":{"content":[{"type":"text","text
":"{\n  \"processList\": []\n}"}]},"jsonrpc":"2.0","id":"req-list-empty-1"}
                            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 zero processes initially
                            [TEST][listEmpty] Received response: {"result":{"con
tent":[{"type":"text","text":"{\n  \"processList\": []\n
}"}]},"jsonrpc":"2.0","id":"req-list-empty-1"}
                            [TEST][listEmpty] Asserting response properties...

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should resp
ond successfully to health_check
                            [TEST][healthCheck] Starting test...
[TEST][healthCheck] Server process check passed.
[TEST][healthCheck] Sending health_check request...
[sendRequest] Sending request (ID req-health-1): {"jsonrpc":"2.0","method":"tool
s/call","params":{"name":"he
alth_check","arguments":{}},"id":"req-health-1"}
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should resp
ond successfully to health_check
                            [Server STDERR RAW]: [mcp-pm] INFO: Tool invoked: he
alth_check { params: {} }

[Server STDERR]: [mcp-pm] INFO: Tool invoked: health_check { params: {} }
[sendRequest][Server STDERR during request req-health-1]: [mcp-pm] INFO: Tool in
voked: health_check { params
: {} }
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should resp
ond successfully to health_check
                            [Server STDERR RAW]: [mcp-pm] INFO: Tool successful:
 health_check {
  responseSummary: '{"status":"ok","server_name":"mcp-pm","version":"0.0.0-place
holder","active_processes":0
,"zombie_che...'
                            }

[Server STDERR]: [mcp-pm] INFO: Tool successful: health_check {
  responseSummary: '{"status":"ok","server_name":"mcp-pm","version":"0.0.0-place
holder","active_processes":0
,"zombie_che...'
                            }
[sendRequest][Server STDERR during request req-health-1]: [mcp-pm] INFO: Tool su
ccessful: health_check {
  responseSummary: '{"status":"ok","server_name":"mcp-pm","version":"0.0.0-place
holder","active_processes":0
,"zombie_che...'
                            }

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should resp
ond successfully to health_check
                            [sendRequest] Received matching response for ID req-
health-1: {"result":{"content":[{"type":"text","text":"{
\"status\":\"ok\",\"server_name\":\"mcp-pm\",\"version\":\"0.0.0-placeholder\",\
"active_processes\":0,\"zombie_check_active\":true}"}]},"jsonrpc":"2.0","id":"re
q-health-1"}                                            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should resp
ond successfully to health_check
                            [TEST][healthCheck] Received response: {"result":{"c
ontent":[{"type":"text","text":"{\"status\":\"ok\",\"ser
ver_name\":\"mcp-pm\",\"version\":\"0.0.0-placeholder\",\"active_processes\":0,\
"zombie_check_active\":true}"}]},"jsonrpc":"2.0","id":"req-health-1"}
                                                        [TEST][healthCheck] Asse
rting response properties...
[TEST][healthCheck] Asserting result properties...
[TEST][healthCheck] Assertions passed.
[TEST][healthCheck] Test finished.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [TEST][startProcess] Starting test...
[TEST][startProcess] Server process check passed.
[TEST][startProcess] Generated label: test-process-1746139854851, CWD: /Users/jo
hnlindquist/dev/mcp-dev-serv
er/tests/integration
                            [TEST][startProcess] Sending start request...
[sendRequest] Sending request (ID req-start-1): {"jsonrpc":"2.0","method":"tools
/call","params":{"name":"sta
rt_process","arguments":{"command":"node","args":["-e","console.log('Node proces
s started'); setTimeout(() => console.log('Node process finished'), 200);"],"wor
kingDirectory":"/Users/johnlindquist/dev/mcp-dev-server/tests/integration","labe
l":"test-process-1746139854851"}},"id":"req-start-1"}
    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: Determined label for start_process: test-proc
ess-1746139854851
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: Determined label for
start_process: test-process-
1746139854851
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] INFO: Determine
d label for start_process: test-process-1746139854851
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: Tool invoked: start_process {
  params: {
    label: 'test-process-1746139854851',
    command: 'node',
    args: [
      '-e',
      "console.log('Node process started'); setTimeout(() => console.log('Node p
rocess finished'), 200);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}

[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: Tool invoked: start_p
rocess {
  params: {
    label: 'test-process-1746139854851',
    command: 'node',
    args: [
      '-e',
      "console.log('Node process started'); setTimeout(() => console.log('Node p
rocess finished'), 200);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] INFO: Tool invo
ked: start_process {
                              params: {
    label: 'test-process-1746139854851',
    command: 'node',
    args: [
      '-e',
      "console.log('Node process started'); setTimeout(() => console.log('Node p
rocess finished'), 200);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: Starting process... Command: "node", Args: [-
e, console.log('Node process started'); setTimeout(() => console.log('Node proce
ss finished'), 200);], CWD: "/Users/johnlindquist/dev/mcp-dev-server/tests/integ
ration", Host: unknown, isRestart: false                
[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: Starting process... C
ommand: "node", Args: [-e, c
onsole.log('Node process started'); setTimeout(() => console.log('Node process f
inished'), 200);], CWD: "/Users/johnlindquist/dev/mcp-dev-server/tests/integrati
on", Host: unknown, isRestart: false                    [sendRequest][Server STD
ERR during request req-start-1]: [mcp-pm test-process-1746139854851] INFO: Start
ing 
process... Command: "node", Args: [-e, console.log('Node process started'); setT
imeout(() => console.log('Node process finished'), 200);], CWD: "/Users/johnlind
quist/dev/mcp-dev-server/tests/integration", Host: unknown, isRestart: false

    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: Verifying working directory: /Users/johnlind
quist/dev/mcp-dev-server/tests/integration
                            [mcp-pm test-process-1746139854851] DEBUG: Working d
irectory verified. 

[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: Verifying working di
rectory: /Users/johnlindquis
t/dev/mcp-dev-server/tests/integration
                            [mcp-pm test-process-1746139854851] DEBUG: Working d
irectory verified.
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] DEBUG: Verifyin
g working directory: /Users/johnlindquist/dev/mcp-dev-server/tests/integration
                            [mcp-pm test-process-1746139854851] DEBUG: Working d
irectory verified.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: Logging process output to: /var/folders/c3/r0
13q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-process-1746139854851.log.
log (mode: a)               
[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: Logging process outpu
t to: /var/folders/c3/r013q3
_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-process-1746139854851.log.log
(mode: a)                   [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] INFO: Logging p
rocess output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-2
4151/test-process-1746139854851.log.log (mode: a)
                                                        
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: Logging process output to: /var/folders/c3/r0
13q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-process-1746139854851.log.
log (mode: a)               
[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: Logging process outpu
t to: /var/folders/c3/r013q3
_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-process-1746139854851.log.log
(mode: a)                   [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] INFO: Logging p
rocess output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-2
4151/test-process-1746139854851.log.log (mode: a)
                                                        
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] WARN: [addLogEntry] Attempted to add log entry for 
unknown process: test-process-1746139854851
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] WARN: [addLogEntry] Attempt
ed to add log entry for unkn
own process: test-process-1746139854851
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] WARN: [addLogEn
try] Attempted to add log entry for unknown process: test-process-1746139854851
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: Attempting to spawn PTY with command: node 

[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: Attempting to spawn
PTY with command: node
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] DEBUG: Attempti
ng to spawn PTY with command: node
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: PTY process spawned with PID: 24156 

[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: PTY process spawned
with PID: 24156
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] DEBUG: PTY proc
ess spawned with PID: 24156
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: PTY process created successfully, PID: 24156 

[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: PTY process created s
uccessfully, PID: 24156
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] INFO: PTY proce
ss created successfully, PID: 24156
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: [updateProcessStatus] Status unchanged: star
ting
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139854853): Proces
s spawned successfully (PID: 24156) in /Users/johnlindquist/dev/mcp-dev-server/t
ests/integrati              [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-process-1746139854851] INFO: No verification pattern provided. Init
ial status: running. 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139854854): Status
: running (no verification specified).
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 2 

[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: [updateProcessStatus
] Status unchanged: starting

                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139854853): Proces
s spawned successfully (PID: 24156) in /Users/johnlindquist/dev/mcp-dev-server/t
ests/integrati              [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-process-1746139854851] INFO: No verification pattern provided. Init
ial status: running. 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139854854): Status
: running (no verification specified).
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 2
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] DEBUG: [updateP
rocessStatus] Status unchanged: starting
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139854853): Proces
s spawned successfully (PID: 24156) in /Users/johnlindquist/dev/mcp-dev-server/t
ests/integrati              [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-process-1746139854851] INFO: No verification pattern provided. Init
ial status: running. 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139854854): Status
: running (no verification specified).
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 2

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: Status changing from starting to running 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139854854): Status
 changed to running
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-process-1746139854851] INFO: Process reached stable running state. 

[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: Status changing from
starting to running 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139854854): Status
 changed to running
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-process-1746139854851] INFO: Process reached stable running state.
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] INFO: Status ch
anging from starting to running
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139854854): Status
 changed to running
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-process-1746139854851] INFO: Process reached stable running state.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: [state.addLogEntry] Pushing log entry (ts: 1
746139854854): Process reached stable running state.
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 4 
[mcp-pm test-process-1746139854851] DEBUG: Waiting for logs to settle (Pause: 20
00ms, Timeout: 15000ms)... 

[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry]
Pushing log entry (ts: 17461
39854854): Process reached stable running state.
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 4 
[mcp-pm test-process-1746139854851] DEBUG: Waiting for logs to settle (Pause: 20
00ms, Timeout: 15000ms)...
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] DEBUG: [state.a
ddLogEntry] Pushing log entry (ts: 1746139854854): Process reached stable runnin
g state.                    [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 4 
[mcp-pm test-process-1746139854851] DEBUG: Waiting for logs to settle (Pause: 20
00ms, Timeout: 15000ms)...

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: [state.addLogEntry] Pushing log entry (ts: 1
746139854881): Node process started
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry]
Pushing log entry (ts: 17461
39854881): Node process started
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] DEBUG: [state.a
ddLogEntry] Pushing log entry (ts: 1746139854881): Node process started
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: [state.addLogEntry] Pushed entry. New log co
unt: 5
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry]
Pushed entry. New log count:
 5
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] DEBUG: [state.a
ddLogEntry] Pushed entry. New log count: 5
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: [state.addLogEntry] Pushing log entry (ts: 1
746139855083): Node process finished
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry]
Pushing log entry (ts: 17461
39855083): Node process finished
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] DEBUG: [state.a
ddLogEntry] Pushing log entry (ts: 1746139855083): Node process finished
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: [state.addLogEntry] Pushed entry. New log co
unt: 6
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry]
Pushed entry. New log count:
 6
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] DEBUG: [state.a
ddLogEntry] Pushed entry. New log count: 6
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: [ExitHandler] Process exited. Code: 0, Signal
: 0
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: [ExitHandler] Process
 exited. Code: 0, Signal: 0
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] INFO: [ExitHand
ler] Process exited. Code: 0, Signal: 0
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: Closing log file stream for test-process-174
6139854851 due to exit.
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139855085): --- Pr
ocess Exited (Code: 0, Signal: 0) ---
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 7 
[mcp-pm test-process-1746139854851] INFO: Process exited cleanly (code 0) from r
unning state. Marking as sto
pped.
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: Closing log file str
eam for test-process-1746139
854851 due to exit.
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139855085): --- Pr
ocess Exited (Code: 0, Signal: 0) ---
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 7 
[mcp-pm test-process-1746139854851] INFO: Process exited cleanly (code 0) from r
unning state. Marking as sto
pped.
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] DEBUG: Closing 
log file stream for test-process-1746139854851 due to exit.
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139855085): --- Pr
ocess Exited (Code: 0, Signal: 0) ---
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 7 
[mcp-pm test-process-1746139854851] INFO: Process exited cleanly (code 0) from r
unning state. Marking as sto
pped.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] INFO: Status changing from running to stopped 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139855085): Status
 changed to stopped
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 8 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139855085): Proces
s ended. Code: 0, Signal: 0
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 9 
[mcp-pm test-process-1746139854851] WARN: Process exited (code: 0, signal: 0) du
ring log settle wait. 

[Server STDERR]: [mcp-pm test-process-1746139854851] INFO: Status changing from
running to stopped 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139855085): Status
 changed to stopped
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 8 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139855085): Proces
s ended. Code: 0, Signal: 0
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 9 
[mcp-pm test-process-1746139854851] WARN: Process exited (code: 0, signal: 0) du
ring log settle wait.
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] INFO: Status ch
anging from running to stopped
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139855085): Status
 changed to stopped
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 8 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139855085): Proces
s ended. Code: 0, Signal: 0
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 9 
[mcp-pm test-process-1746139854851] WARN: Process exited (code: 0, signal: 0) du
ring log settle wait.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: [_waitForLogSettleOrTimeout] Disposing tempo
rary exit listener.
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: [_waitForLogSettleOr
Timeout] Disposing temporary
 exit listener.
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] DEBUG: [_waitFo
rLogSettleOrTimeout] Disposing temporary exit listener.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: Log settle wait completed. 
[mcp-pm test-process-1746139854851] INFO: Final status for payload construction:
 stopped 

[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: Log settle wait comp
leted. 
[mcp-pm test-process-1746139854851] INFO: Final status for payload construction:
 stopped
[sendRequest][Server STDERR during request req-start-1]: [mcp-pm test-process-17
46139854851] DEBUG: Log sett
le wait completed.
                            [mcp-pm test-process-1746139854851] INFO: Final stat
us for payload construction: stopped

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] ERROR: Tool execution failed: start_process { error
: 'line.trim is not a function' }
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] ERROR: Tool execution faile
d: start_process { error: 'l
ine.trim is not a function' }
                            [sendRequest][Server STDERR during request req-start
-1]: [mcp-pm test-process-1746139854851] ERROR: Tool exe
cution failed: start_process { error: 'line.trim is not a function' }
                            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [sendRequest] Received matching response for ID req-
start-1: {"result":{"isError":true,"content":[{"type":"t
ext","text":"{\n  \"error\": \"Tool execution failed: line.trim is not a functio
n\"\n}"}]},"jsonrpc":"2.0","id":"req-start-1"}
                                                        
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should star
t a simple process and receive confirmation
                            [TEST][startProcess] Received response: {"result":{"
isError":true,"content":[{"type":"text","text":"{\n  \"e
rror\": \"Tool execution failed: line.trim is not a function\"\n}"}]},"jsonrpc":
"2.0","id":"req-start-1"}   [TEST][startProcess] Asserting response properties..
.
[TEST][startProcess] Asserting result properties...

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [TEST][listOne] Starting test...
[TEST][listOne] Starting process test-list-1746139855087...
[sendRequest] Sending request (ID req-start-for-list-1): {"jsonrpc":"2.0","metho
d":"tools/call","params":{"n
ame":"start_process","arguments":{"command":"node","args":["-e","console.log('Pr
ocess for listing test'); setInterval(() => {}, 1000);"],"workingDirectory":"/Us
ers/johnlindquist/dev/mcp-dev-server/tests/integration","label":"test-list-17461
39855087"}},"id":"req-start-for-list-1"}
    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: Log file stream for test-process-17461398548
51 finished writing and closed.
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: Log file stream for
test-process-1746139854851 f
inished writing and closed.
                            [sendRequest][Server STDERR during request req-start
-for-list-1]: [mcp-pm test-process-1746139854851] DEBUG:
 Log file stream for test-process-1746139854851 finished writing and closed.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] INFO: Determined label for start_process: test-list-17
46139855087
                            
[Server STDERR]: [mcp-pm test-list-1746139855087] INFO: Determined label for sta
rt_process: test-list-174613
9855087
                            [sendRequest][Server STDERR during request req-start
-for-list-1]: [mcp-pm test-list-1746139855087] INFO: Det
ermined label for start_process: test-list-1746139855087
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] INFO: Tool invoked: start_process {
  params: {
    label: 'test-list-1746139855087',
    command: 'node',
    args: [
      '-e',
      "console.log('Process for listing test'); setInterval(() => {}, 1000);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}

[Server STDERR]: [mcp-pm test-list-1746139855087] INFO: Tool invoked: start_proc
ess {
  params: {
    label: 'test-list-1746139855087',
    command: 'node',
    args: [
      '-e',
      "console.log('Process for listing test'); setInterval(() => {}, 1000);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] INFO: Too
l invoked: start_process {
                              params: {
    label: 'test-list-1746139855087',
    command: 'node',
    args: [
      '-e',
      "console.log('Process for listing test'); setInterval(() => {}, 1000);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] INFO: Starting process... Command: "node", Args: [-e, 
console.log('Process for listing test'); setInterval(() => {}, 1000);], CWD: "/U
sers/johnlindquist/dev/mcp-dev-server/tests/integration", Host: unknown, isResta
rt: false                                               [mcp-pm test-list-174613
9855087] DEBUG: Verifying working directory: /Users/johnlindquist/dev/mcp-dev-se
rver
/tests/integration
                            [mcp-pm test-list-1746139855087] DEBUG: Working dire
ctory verified. 

[Server STDERR]: [mcp-pm test-list-1746139855087] INFO: Starting process... Comm
and: "node", Args: [-e, cons
ole.log('Process for listing test'); setInterval(() => {}, 1000);], CWD: "/Users
/johnlindquist/dev/mcp-dev-server/tests/integration", Host: unknown, isRestart:
false                                                   [mcp-pm test-list-174613
9855087] DEBUG: Verifying working directory: /Users/johnlindquist/dev/mcp-dev-se
rver
/tests/integration
                            [mcp-pm test-list-1746139855087] DEBUG: Working dire
ctory verified.
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] INFO: Sta
rting process... Command: "node", Args: [-e, console.log('Process for listing te
st'); setInterval(() => {}, 1000);], CWD: "/Users/johnlindquist/dev/mcp-dev-serv
er/tests/integration", Host: unknown, isRestart: false  [mcp-pm test-list-174613
9855087] DEBUG: Verifying working directory: /Users/johnlindquist/dev/mcp-dev-se
rver
/tests/integration
                            [mcp-pm test-list-1746139855087] DEBUG: Working dire
ctory verified.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] INFO: Logging process output to: /var/folders/c3/r013q
3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-list-1746139855087.log.log (m
ode: a)                     
[Server STDERR]: [mcp-pm test-list-1746139855087] INFO: Logging process output t
o: /var/folders/c3/r013q3_93
_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-list-1746139855087.log.log (mode:
 a)                         [sendRequest][Server STDERR during request req-start
-for-list-1]: [mcp-pm test-list-1746139855087] INFO: Log
ging process output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-
logs-24151/test-list-1746139855087.log.log (mode: a)
                                                        
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] INFO: Logging process output to: /var/folders/c3/r013q
3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-list-1746139855087.log.log (m
ode: a)                     [mcp-pm test-list-1746139855087] WARN: [addLogEntry]
 Attempted to add log entry for unknown process: test-li
st-1746139855087
                            [mcp-pm test-list-1746139855087] DEBUG: Attempting t
o spawn PTY with command: node 

[Server STDERR]: [mcp-pm test-list-1746139855087] INFO: Logging process output t
o: /var/folders/c3/r013q3_93
_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-list-1746139855087.log.log (mode:
 a)                         [mcp-pm test-list-1746139855087] WARN: [addLogEntry]
 Attempted to add log entry for unknown process: test-li
st-1746139855087
                            [mcp-pm test-list-1746139855087] DEBUG: Attempting t
o spawn PTY with command: node
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] INFO: Log
ging process output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-
logs-24151/test-list-1746139855087.log.log (mode: a)
                                                        [mcp-pm test-list-174613
9855087] WARN: [addLogEntry] Attempted to add log entry for unknown process: tes
t-li
st-1746139855087
                            [mcp-pm test-list-1746139855087] DEBUG: Attempting t
o spawn PTY with command: node

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: PTY process spawned with PID: 24160 

[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: PTY process spawned wit
h PID: 24160
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] DEBUG: PT
Y process spawned with PID: 24160
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] INFO: PTY process created successfully, PID: 24160 
[mcp-pm test-list-1746139855087] DEBUG: [updateProcessStatus] Status unchanged:
starting 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Process s
pawned successfully (PID: 24160) in /Users/johnlindquist/dev/mcp-dev-server/test
s/integrati                 [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 1 
[mcp-pm test-list-1746139855087] INFO: No verification pattern provided. Initial
 status: running. 

[Server STDERR]: [mcp-pm test-list-1746139855087] INFO: PTY process created succ
essfully, PID: 24160 
[mcp-pm test-list-1746139855087] DEBUG: [updateProcessStatus] Status unchanged:
starting 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Process s
pawned successfully (PID: 24160) in /Users/johnlindquist/dev/mcp-dev-server/test
s/integrati                 [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 1 
[mcp-pm test-list-1746139855087] INFO: No verification pattern provided. Initial
 status: running.
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] INFO: PTY
 process created successfully, PID: 24160
                            [mcp-pm test-list-1746139855087] DEBUG: [updateProce
ssStatus] Status unchanged: starting 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Process s
pawned successfully (PID: 24160) in /Users/johnlindquist/dev/mcp-dev-server/test
s/integrati                 [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 1 
[mcp-pm test-list-1746139855087] INFO: No verification pattern provided. Initial
 status: running.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: [state.addLogEntry] Pushing log entry (ts: 1746
139855088): Status: running (no verification specified).
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 2 
[mcp-pm test-list-1746139855087] INFO: Status changing from starting to running 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Status ch
anged to running
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 3 
[mcp-pm test-list-1746139855087] INFO: Process reached stable running state. 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Process r
eached stable running state.
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 4 

[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pus
hing log entry (ts: 17461398
55088): Status: running (no verification specified).
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 2 
[mcp-pm test-list-1746139855087] INFO: Status changing from starting to running 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Status ch
anged to running
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 3 
[mcp-pm test-list-1746139855087] INFO: Process reached stable running state. 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Process r
eached stable running state.
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 4
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] DEBUG: [s
tate.addLogEntry] Pushing log entry (ts: 1746139855088): Status: running (no ver
ification specified).       [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 2 
[mcp-pm test-list-1746139855087] INFO: Status changing from starting to running 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Status ch
anged to running
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 3 
[mcp-pm test-list-1746139855087] INFO: Process reached stable running state. 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139855088): Process r
eached stable running state.
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 4

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: Waiting for logs to settle (Pause: 2000ms, Time
out: 15000ms)...
                            
[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: Waiting for logs to set
tle (Pause: 2000ms, Timeout:
 15000ms)...
                            [sendRequest][Server STDERR during request req-start
-for-list-1]: [mcp-pm test-list-1746139855087] DEBUG: Wa
iting for logs to settle (Pause: 2000ms, Timeout: 15000ms)...
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: [state.addLogEntry] Pushing log entry (ts: 1746
139855115): Process for listing test
                            
[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pus
hing log entry (ts: 17461398
55115): Process for listing test
                            [sendRequest][Server STDERR during request req-start
-for-list-1]: [mcp-pm test-list-1746139855087] DEBUG: [s
tate.addLogEntry] Pushing log entry (ts: 1746139855115): Process for listing tes
t                           
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: [state.addLogEntry] Pushed entry. New log count
: 5
                            
[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pus
hed entry. New log count: 5
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] DEBUG: [s
tate.addLogEntry] Pushed entry. New log count: 5
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: Logs settled after 2000ms pause. 

[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: Logs settled after 2000
ms pause.
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] DEBUG: Lo
gs settled after 2000ms pause.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: [_waitForLogSettleOrTimeout] Disposing temporar
y exit listener.
                            [mcp-pm test-list-1746139855087] DEBUG: Log settle w
ait completed. 
[mcp-pm test-list-1746139855087] INFO: Final status for payload construction: ru
nning 

[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: [_waitForLogSettleOrTim
eout] Disposing temporary ex
it listener.
                            [mcp-pm test-list-1746139855087] DEBUG: Log settle w
ait completed. 
[mcp-pm test-list-1746139855087] INFO: Final status for payload construction: ru
nning
[sendRequest][Server STDERR during request req-start-for-list-1]: [mcp-pm test-l
ist-1746139855087] DEBUG: [_
waitForLogSettleOrTimeout] Disposing temporary exit listener.
                            [mcp-pm test-list-1746139855087] DEBUG: Log settle w
ait completed. 
[mcp-pm test-list-1746139855087] INFO: Final status for payload construction: ru
nning

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] ERROR: Tool execution failed: start_process { error: '
line.trim is not a function' }
                            
[Server STDERR]: [mcp-pm test-list-1746139855087] ERROR: Tool execution failed:
start_process { error: 'line
.trim is not a function' }
                            [sendRequest][Server STDERR during request req-start
-for-list-1]: [mcp-pm test-list-1746139855087] ERROR: To
ol execution failed: start_process { error: 'line.trim is not a function' }
                            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [sendRequest] Received matching response for ID req-
start-for-list-1: {"result":{"isError":true,"content":[{
"type":"text","text":"{\n  \"error\": \"Tool execution failed: line.trim is not
a function\"\n}"}]},"jsonrpc":"2.0","id":"req-start-for-list-1"}
                                                        
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [TEST][listOne] Process test-list-1746139855087 star
ted.
[TEST][listOne] Sending list_processes request...
[sendRequest] Sending request (ID req-list-one-1): {"jsonrpc":"2.0","method":"to
ols/call","params":{"name":"
list_processes","arguments":{"log_lines":5}},"id":"req-list-one-1"}
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm] INFO: Tool invoked: li
st_processes { params: { log_lines: 5 } }

[Server STDERR]: [mcp-pm] INFO: Tool invoked: list_processes { params: { log_lin
es: 5 } }
[sendRequest][Server STDERR during request req-list-one-1]: [mcp-pm] INFO: Tool
invoked: list_processes { pa
rams: { log_lines: 5 } }
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: [checkAndUpdateProcessStatus START] Initial 
ProcessInfo found: true, Status: stopped
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: [checkAndUpdateProce
ssStatus START] Initial Proc
essInfo found: true, Status: stopped
                            [sendRequest][Server STDERR during request req-list-
one-1]: [mcp-pm test-process-1746139854851] DEBUG: [chec
kAndUpdateProcessStatus START] Initial ProcessInfo found: true, Status: stopped
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-process-1746139854
851] DEBUG: Process check: Status is stopped. No update 
needed.
                            [mcp-pm test-process-1746139854851] DEBUG: [checkAnd
UpdateProcessStatus END] Returning ProcessInfo. Status: 
stopped
                            
[Server STDERR]: [mcp-pm test-process-1746139854851] DEBUG: Process check: Statu
s is stopped. No update need
ed.
                            [mcp-pm test-process-1746139854851] DEBUG: [checkAnd
UpdateProcessStatus END] Returning ProcessInfo. Status: 
stopped
                            [sendRequest][Server STDERR during request req-list-
one-1]: [mcp-pm test-process-1746139854851] DEBUG: Proce
ss check: Status is stopped. No update needed.
                            [mcp-pm test-process-1746139854851] DEBUG: [checkAnd
UpdateProcessStatus END] Returning ProcessInfo. Status: 
stopped
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: [checkAndUpdateProcessStatus START] Initial Pro
cessInfo found: true, Status: running
                            
[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: [checkAndUpdateProcessS
tatus START] Initial Process
Info found: true, Status: running
                            [sendRequest][Server STDERR during request req-list-
one-1]: [mcp-pm test-list-1746139855087] DEBUG: [checkAn
dUpdateProcessStatus START] Initial ProcessInfo found: true, Status: running
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm test-list-1746139855087
] DEBUG: Process check (kill 0): PID 24160 exists. Statu
s remains running.
                            [mcp-pm test-list-1746139855087] DEBUG: [checkAndUpd
ateProcessStatus END] Returning ProcessInfo. Status: run
ning
                            
[Server STDERR]: [mcp-pm test-list-1746139855087] DEBUG: Process check (kill 0):
 PID 24160 exists. Status re
mains running.
                            [mcp-pm test-list-1746139855087] DEBUG: [checkAndUpd
ateProcessStatus END] Returning ProcessInfo. Status: run
ning
                            [sendRequest][Server STDERR during request req-list-
one-1]: [mcp-pm test-list-1746139855087] DEBUG: Process 
check (kill 0): PID 24160 exists. Status remains running.
                            [mcp-pm test-list-1746139855087] DEBUG: [checkAndUpd
ateProcessStatus END] Returning ProcessInfo. Status: run
ning
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [Server STDERR RAW]: [mcp-pm] INFO: Tool successful:
 list_processes {
  responseSummary: '{\n' +
    '  "processList": [\n' +
    '    {\n' +
    '      "label": "test-process-1746139854851",\n' +
    '      "status": "stopped",\n' +
    ' ...'
}

[Server STDERR]: [mcp-pm] INFO: Tool successful: list_processes {
  responseSummary: '{\n' +
    '  "processList": [\n' +
    '    {\n' +
    '      "label": "test-process-1746139854851",\n' +
    '      "status": "stopped",\n' +
    ' ...'
}
[sendRequest][Server STDERR during request req-list-one-1]: [mcp-pm] INFO: Tool
successful: list_processes {
  responseSummary: '{\n' +
    '  "processList": [\n' +
    '    {\n' +
    '      "label": "test-process-1746139854851",\n' +
    '      "status": "stopped",\n' +
    ' ...'
}

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [sendRequest] Received matching response for ID req-
list-one-1: {"result":{"content":[{"type":"text","text":
"{\n  \"processList\": [\n    {\n      \"label\": \"test-process-1746139854851\"
,\n      \"status\": \"stopped\",\n      \"pid\": 24156,\n      \"command\": \"n
ode\",\n      \"args\": [\n        \"-e\",\n        \"console.log('Node process
started'); setTimeout(() => console.log('Node process finished'), 200);\"\n
 ],\n      \"cwd\": \"/Users/johnlindquist/dev/mcp-dev-server/tests/integration\
",\n      \"exitCode\": 0,\n      \"signal\": \"0\",\n      \"logs\": [\n
 \"Node process started\",\n        \"Node process finished\",\n        \"--- Pr
ocess Exited (Code: 0, Signal: 0) ---\",\n        \"Status changed to stopped\",
\n        \"Process ended. Code: 0, Signal: 0\"\n      ],\n      \"log_hint\": \
"Showing 5 lines. 4 older stored.\",\n      \"log_file_path\": \"/var/folders/c3
/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-process-1746139854851.l
og.log\",\n      \"tail_command\": \"tail -f \\\"/var/folders/c3/r013q3_93_s4zyc
mx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-process-1746139854851.log.log\\\"\"\n
  },\n    {\n      \"label\": \"test-list-1746139855087\",\n      \"status\": \"
running\",\n      \"pid\": 24160,\n      \"command\": \"node\",\n      \"args\":
 [\n        \"-e\",\n        \"console.log('Process for listing test'); setInter
val(() => {}, 1000);\"\n      ],\n      \"cwd\": \"/Users/johnlindquist/dev/mcp-
dev-server/tests/integration\",\n      \"exitCode\": null,\n      \"signal\": nu
ll,\n      \"logs\": [\n        \"Process spawned successfully (PID: 24160) in /
Users/johnlindquist/dev/mcp-dev-server/tests/integration. Status: starting.\",\n
        \"Status: running (no verification specified).\",\n        \"Status chan
ged to running\",\n        \"Process reached stable running state.\",\n        \
"Process for listing test\"\n      ],\n      \"log_hint\": null,\n      \"log_fi
le_path\": \"/var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/
test-list-1746139855087.log.log\",\n      \"tail_command\": \"tail -f \\\"/var/f
olders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-list-174613985
5087.log.log\\\"\"\n    }\n  ]\n}"}]},"jsonrpc":"2.0","id":"req-list-one-1"}

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should list
 one running process after starting it
                            [TEST][listOne] Received response: {"result":{"conte
nt":[{"type":"text","text":"{\n  \"processList\": [\n   
 {\n      \"label\": \"test-process-1746139854851\",\n      \"status\": \"stoppe
d\",\n      \"pid\": 24156,\n      \"command\": \"node\",\n      \"args\": [\n
      \"-e\",\n        \"console.log('Node process started'); setTimeout(() => c
onsole.log('Node process finished'), 200);\"\n      ],\n      \"cwd\": \"/Users/
johnlindquist/dev/mcp-dev-server/tests/integration\",\n      \"exitCode\": 0,\n
     \"signal\": \"0\",\n      \"logs\": [\n        \"Node process started\",\n
       \"Node process finished\",\n        \"--- Process Exited (Code: 0, Signal
: 0) ---\",\n        \"Status changed to stopped\",\n        \"Process ended. Co
de: 0, Signal: 0\"\n      ],\n      \"log_hint\": \"Showing 5 lines. 4 older sto
red.\",\n      \"log_file_path\": \"/var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000
gn/T/mcp-pm-logs-24151/test-process-1746139854851.log.log\",\n      \"tail_comma
nd\": \"tail -f \\\"/var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs
-24151/test-process-1746139854851.log.log\\\"\"\n    },\n    {\n      \"label\":
 \"test-list-1746139855087\",\n      \"status\": \"running\",\n      \"pid\": 24
160,\n      \"command\": \"node\",\n      \"args\": [\n        \"-e\",\n
\"console.log('Process for listing test'); setInterval(() => {}, 1000);\"\n
 ],\n      \"cwd\": \"/Users/johnlindquist/dev/mcp-dev-server/tests/integration\
",\n      \"exitCode\": null,\n      \"signal\": null,\n      \"logs\": [\n
   \"Process spawned successfully (PID: 24160) in /Users/johnlindquist/dev/mcp-d
ev-server/tests/integration. Status: starting.\",\n        \"Status: running (no
 verification specified).\",\n        \"Status changed to running\",\n        \"
Process reached stable running state.\",\n        \"Process for listing test\"\n
      ],\n      \"log_hint\": null,\n      \"log_file_path\": \"/var/folders/c3/
r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-list-1746139855087.log.l
og\",\n      \"tail_command\": \"tail -f \\\"/var/folders/c3/r013q3_93_s4zycmx0m
dnt2h0000gn/T/mcp-pm-logs-24151/test-list-1746139855087.log.log\\\"\"\n    }\n
]\n}"}]},"jsonrpc":"2.0","id":"req-list-one-1"}
[TEST][listOne] Asserting response properties...

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [TEST][checkStatus] Starting test...
[TEST][checkStatus] Starting process test-check-1746139857096...
[sendRequest] Sending request (ID req-start-for-check-1): {"jsonrpc":"2.0","meth
od":"tools/call","params":{"
name":"start_process","arguments":{"command":"node","args":["-e","console.log('P
rocess for checking status'); setInterval(() => {}, 1000);"],"workingDirectory":
"/Users/johnlindquist/dev/mcp-dev-server/tests/integration","label":"test-check-
1746139857096"}},"id":"req-start-for-check-1"}
    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Determined label for start_process: test-check-
1746139857096
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Determined label for st
art_process: test-check-1746
139857096
                            [sendRequest][Server STDERR during request req-start
-for-check-1]: [mcp-pm test-check-1746139857096] INFO: D
etermined label for start_process: test-check-1746139857096
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Tool invoked: start_process {
  params: {
    label: 'test-check-1746139857096',
    command: 'node',
    args: [
      '-e',
      "console.log('Process for checking status'); setInterval(() => {}, 1000);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}

[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Tool invoked: start_pro
cess {
  params: {
    label: 'test-check-1746139857096',
    command: 'node',
    args: [
      '-e',
      "console.log('Process for checking status'); setInterval(() => {}, 1000);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}
[sendRequest][Server STDERR during request req-start-for-check-1]: [mcp-pm test-
check-1746139857096] INFO: T
ool invoked: start_process {
                              params: {
    label: 'test-check-1746139857096',
    command: 'node',
    args: [
      '-e',
      "console.log('Process for checking status'); setInterval(() => {}, 1000);"
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Starting process... Command: "node", Args: [-e,
 console.log('Process for checking status'); setInterval(() => {}, 1000);], CWD:
 "/Users/johnlindquist/dev/mcp-dev-server/tests/integration", Host: unknown, isR
estart: false                                           [mcp-pm test-check-17461
39857096] DEBUG: Verifying working directory: /Users/johnlindquist/dev/mcp-dev-s
erve
r/tests/integration
                            [mcp-pm test-check-1746139857096] DEBUG: Working dir
ectory verified. 

[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Starting process... Com
mand: "node", Args: [-e, con
sole.log('Process for checking status'); setInterval(() => {}, 1000);], CWD: "/U
sers/johnlindquist/dev/mcp-dev-server/tests/integration", Host: unknown, isResta
rt: false                                               [mcp-pm test-check-17461
39857096] DEBUG: Verifying working directory: /Users/johnlindquist/dev/mcp-dev-s
erve
r/tests/integration
                            [mcp-pm test-check-1746139857096] DEBUG: Working dir
ectory verified.
[sendRequest][Server STDERR during request req-start-for-check-1]: [mcp-pm test-
check-1746139857096] INFO: S
tarting process... Command: "node", Args: [-e, console.log('Process for checking
 status'); setInterval(() => {}, 1000);], CWD: "/Users/johnlindquist/dev/mcp-dev
-server/tests/integration", Host: unknown, isRestart: false

    [mcp-pm test-check-1746139857096] DEBUG: Verifying working directory: /Users
/johnlindquist/dev/mcp-dev-serve
r/tests/integration
                            [mcp-pm test-check-1746139857096] DEBUG: Working dir
ectory verified.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Logging process output to: /var/folders/c3/r013
q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-check-1746139857096.log.log
(mode: a)                   [mcp-pm test-check-1746139857096] INFO: Logging proc
ess output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h0
000gn/T/mcp-pm-logs-24151/test-check-1746139857096.log.log (mode: a)
                            [mcp-pm test-check-1746139857096] WARN: [addLogEntry
] Attempted to add log entry for unknown process: test-c
heck-1746139857096
                            [mcp-pm test-check-1746139857096] DEBUG: Attempting
to spawn PTY with command: node 

[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Logging process output
to: /var/folders/c3/r013q3_9
3_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-check-1746139857096.log.log (mod
e: a)                       [mcp-pm test-check-1746139857096] INFO: Logging proc
ess output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h0
000gn/T/mcp-pm-logs-24151/test-check-1746139857096.log.log (mode: a)
                            [mcp-pm test-check-1746139857096] WARN: [addLogEntry
] Attempted to add log entry for unknown process: test-c
heck-1746139857096
                            [mcp-pm test-check-1746139857096] DEBUG: Attempting
to spawn PTY with command: node
[sendRequest][Server STDERR during request req-start-for-check-1]: [mcp-pm test-
check-1746139857096] INFO: L
ogging process output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-p
m-logs-24151/test-check-1746139857096.log.log (mode: a)
                                                        [mcp-pm test-check-17461
39857096] INFO: Logging process output to: /var/folders/c3/r013q3_93_s4zycmx0mdn
t2h0
000gn/T/mcp-pm-logs-24151/test-check-1746139857096.log.log (mode: a)
                            [mcp-pm test-check-1746139857096] WARN: [addLogEntry
] Attempted to add log entry for unknown process: test-c
heck-1746139857096
                            [mcp-pm test-check-1746139857096] DEBUG: Attempting
to spawn PTY with command: node

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: PTY process spawned with PID: 24202 

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: PTY process spawned wi
th PID: 24202
[sendRequest][Server STDERR during request req-start-for-check-1]: [mcp-pm test-
check-1746139857096] DEBUG: 
PTY process spawned with PID: 24202
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: PTY process created successfully, PID: 24202 
[mcp-pm test-check-1746139857096] DEBUG: [updateProcessStatus] Status unchanged:
 starting 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Process 
spawned successfully (PID: 24202) in /Users/johnlindquist/dev/mcp-dev-server/tes
ts/integrati                [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 1 
[mcp-pm test-check-1746139857096] INFO: No verification pattern provided. Initia
l status: running. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Status: 
running (no verification specified).
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 2 
[mcp-pm test-check-1746139857096] INFO: Status changing from starting to running
 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Status c
hanged to running
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: PTY process created suc
cessfully, PID: 24202 
[mcp-pm test-check-1746139857096] DEBUG: [updateProcessStatus] Status unchanged:
 starting 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Process 
spawned successfully (PID: 24202) in /Users/johnlindquist/dev/mcp-dev-server/tes
ts/integrati                [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 1 
[mcp-pm test-check-1746139857096] INFO: No verification pattern provided. Initia
l status: running. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Status: 
running (no verification specified).
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 2 
[mcp-pm test-check-1746139857096] INFO: Status changing from starting to running
 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Status c
hanged to running
                            [sendRequest][Server STDERR during request req-start
-for-check-1]: [mcp-pm test-check-1746139857096] INFO: P
TY process created successfully, PID: 24202
                            [mcp-pm test-check-1746139857096] DEBUG: [updateProc
essStatus] Status unchanged: starting 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Process 
spawned successfully (PID: 24202) in /Users/johnlindquist/dev/mcp-dev-server/tes
ts/integrati                [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 1 
[mcp-pm test-check-1746139857096] INFO: No verification pattern provided. Initia
l status: running. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Status: 
running (no verification specified).
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 2 
[mcp-pm test-check-1746139857096] INFO: Status changing from starting to running
 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Status c
hanged to running
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: [state.addLogEntry] Pushed entry. New log coun
t: 3
                            [mcp-pm test-check-1746139857096] INFO: Process reac
hed stable running state. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Process 
reached stable running state.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 4 
[mcp-pm test-check-1746139857096] DEBUG: Waiting for logs to settle (Pause: 2000
ms, Timeout: 15000ms)... 

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pu
shed entry. New log count: 3

                            [mcp-pm test-check-1746139857096] INFO: Process reac
hed stable running state. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Process 
reached stable running state.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 4 
[mcp-pm test-check-1746139857096] DEBUG: Waiting for logs to settle (Pause: 2000
ms, Timeout: 15000ms)...
[sendRequest][Server STDERR during request req-start-for-check-1]: [mcp-pm test-
check-1746139857096] DEBUG: 
[state.addLogEntry] Pushed entry. New log count: 3
                            [mcp-pm test-check-1746139857096] INFO: Process reac
hed stable running state. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139857099): Process 
reached stable running state.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 4 
[mcp-pm test-check-1746139857096] DEBUG: Waiting for logs to settle (Pause: 2000
ms, Timeout: 15000ms)...

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: [state.addLogEntry] Pushing log entry (ts: 174
6139857125): Process for checking status
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pu
shing log entry (ts: 1746139
857125): Process for checking status
                            [sendRequest][Server STDERR during request req-start
-for-check-1]: [mcp-pm test-check-1746139857096] DEBUG: 
[state.addLogEntry] Pushing log entry (ts: 1746139857125): Process for checking
status                      
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: [state.addLogEntry] Pushed entry. New log coun
t: 5
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pu
shed entry. New log count: 5
[sendRequest][Server STDERR during request req-start-for-check-1]: [mcp-pm test-
check-1746139857096] DEBUG: 
[state.addLogEntry] Pushed entry. New log count: 5
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: Logs settled after 2000ms pause. 

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: Logs settled after 200
0ms pause.
[sendRequest][Server STDERR during request req-start-for-check-1]: [mcp-pm test-
check-1746139857096] DEBUG: 
Logs settled after 2000ms pause.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: [_waitForLogSettleOrTimeout] Disposing tempora
ry exit listener.
                            [mcp-pm test-check-1746139857096] DEBUG: Log settle
wait completed. 
[mcp-pm test-check-1746139857096] INFO: Final status for payload construction: r
unning 

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: [_waitForLogSettleOrTi
meout] Disposing temporary e
xit listener.
                            [mcp-pm test-check-1746139857096] DEBUG: Log settle
wait completed. 
[mcp-pm test-check-1746139857096] INFO: Final status for payload construction: r
unning
[sendRequest][Server STDERR during request req-start-for-check-1]: [mcp-pm test-
check-1746139857096] DEBUG: 
[_waitForLogSettleOrTimeout] Disposing temporary exit listener.
                            [mcp-pm test-check-1746139857096] DEBUG: Log settle
wait completed. 
[mcp-pm test-check-1746139857096] INFO: Final status for payload construction: r
unning

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] ERROR: Tool execution failed: start_process { error: 
'line.trim is not a function' }
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] ERROR: Tool execution failed:
 start_process { error: 'lin
e.trim is not a function' }
                            [sendRequest][Server STDERR during request req-start
-for-check-1]: [mcp-pm test-check-1746139857096] ERROR: 
Tool execution failed: start_process { error: 'line.trim is not a function' }
                            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [sendRequest] Received matching response for ID req-
start-for-check-1: {"result":{"isError":true,"content":[
{"type":"text","text":"{\n  \"error\": \"Tool execution failed: line.trim is not
 a function\"\n}"}]},"jsonrpc":"2.0","id":"req-start-for-check-1"}
                                                        
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [TEST][checkStatus] Process test-check-1746139857096
 started.
[TEST][checkStatus] Sending check_process_status request...
[sendRequest] Sending request (ID req-check-1): {"jsonrpc":"2.0","method":"tools
/call","params":{"name":"che
ck_process_status","arguments":{"label":"test-check-1746139857096"}},"id":"req-c
heck-1"}                    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Tool invoked: check_process_status { params: { 
label: 'test-check-1746139857096', log_lines: 20 } }
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Tool invoked: check_pro
cess_status { params: { labe
l: 'test-check-1746139857096', log_lines: 20 } }
                            [sendRequest][Server STDERR during request req-check
-1]: [mcp-pm test-check-1746139857096] INFO: Tool invoke
d: check_process_status { params: { label: 'test-check-1746139857096', log_lines
: 20 } }                    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: Tool invoked: check_process_status { params: {
 label: 'test-check-1746139857096', log_lines: 20 } }
                            [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus START] Initial ProcessInfo found: true
, Status: running
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: Tool invoked: check_pr
ocess_status { params: { lab
el: 'test-check-1746139857096', log_lines: 20 } }
                            [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus START] Initial ProcessInfo found: true
, Status: running
                            [sendRequest][Server STDERR during request req-check
-1]: [mcp-pm test-check-1746139857096] DEBUG: Tool invok
ed: check_process_status { params: { label: 'test-check-1746139857096', log_line
s: 20 } }                   [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus START] Initial ProcessInfo found: true
, Status: running
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: Process check (kill 0): PID 24202 exists. Stat
us remains running.
                            [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus END] Returning ProcessInfo. Status: ru
nning
                            [mcp-pm test-check-1746139857096] DEBUG: Filtering l
ogs. Total logs available: 5. Filtering for timestamp > 
0
                            [mcp-pm test-check-1746139857096] DEBUG: Found 5 new
 log entries. 
[mcp-pm test-check-1746139857096] DEBUG: Updating lastLogTimestampReturned in pr
ocess state to 1746139857125

                            [mcp-pm test-check-1746139857096] DEBUG: Requested l
og lines: 20 (Default: 20) 
[mcp-pm test-check-1746139857096] DEBUG: Returning 5 raw log lines (limited by r
equest). 

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: Process check (kill 0)
: PID 24202 exists. Status r
emains running.
                            [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus END] Returning ProcessInfo. Status: ru
nning
                            [mcp-pm test-check-1746139857096] DEBUG: Filtering l
ogs. Total logs available: 5. Filtering for timestamp > 
0
                            [mcp-pm test-check-1746139857096] DEBUG: Found 5 new
 log entries. 
[mcp-pm test-check-1746139857096] DEBUG: Updating lastLogTimestampReturned in pr
ocess state to 1746139857125

                            [mcp-pm test-check-1746139857096] DEBUG: Requested l
og lines: 20 (Default: 20) 
[mcp-pm test-check-1746139857096] DEBUG: Returning 5 raw log lines (limited by r
equest).
[sendRequest][Server STDERR during request req-check-1]: [mcp-pm test-check-1746
139857096] DEBUG: Process ch
eck (kill 0): PID 24202 exists. Status remains running.
                            [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus END] Returning ProcessInfo. Status: ru
nning
                            [mcp-pm test-check-1746139857096] DEBUG: Filtering l
ogs. Total logs available: 5. Filtering for timestamp > 
0
                            [mcp-pm test-check-1746139857096] DEBUG: Found 5 new
 log entries. 
[mcp-pm test-check-1746139857096] DEBUG: Updating lastLogTimestampReturned in pr
ocess state to 1746139857125

                            [mcp-pm test-check-1746139857096] DEBUG: Requested l
og lines: 20 (Default: 20) 
[mcp-pm test-check-1746139857096] DEBUG: Returning 5 raw log lines (limited by r
equest).

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: check_process_status returning final status: ru
nning. New logs returned: 5. New lastLogTimestamp: 1746139857125
                            [mcp-pm test-check-1746139857096] INFO: Tool success
ful: check_process_status {
  responseSummary: '{"label":"test-check-1746139857096","status":"running","pid"
:24202,"command":"node","arg
s":["-e","co...'
                            }

[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: check_process_status re
turning final status: runnin
g. New logs returned: 5. New lastLogTimestamp: 1746139857125
                            [mcp-pm test-check-1746139857096] INFO: Tool success
ful: check_process_status {
  responseSummary: '{"label":"test-check-1746139857096","status":"running","pid"
:24202,"command":"node","arg
s":["-e","co...'
                            }
[sendRequest][Server STDERR during request req-check-1]: [mcp-pm test-check-1746
139857096] INFO: check_proce
ss_status returning final status: running. New logs returned: 5. New lastLogTime
stamp: 1746139857125        [mcp-pm test-check-1746139857096] INFO: Tool success
ful: check_process_status {
  responseSummary: '{"label":"test-check-1746139857096","status":"running","pid"
:24202,"command":"node","arg
s":["-e","co...'
                            }

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [sendRequest] Received matching response for ID req-
check-1: {"result":{"content":[{"type":"text","text":"{\
"label\":\"test-check-1746139857096\",\"status\":\"running\",\"pid\":24202,\"com
mand\":\"node\",\"args\":[\"-e\",\"console.log('Process for checking status'); s
etInterval(() => {}, 1000);\"],\"cwd\":\"/Users/johnlindquist/dev/mcp-dev-server
/tests/integration\",\"exitCode\":null,\"signal\":null,\"logs\":[\"Process spawn
ed successfully (PID: 24202) in /Users/johnlindquist/dev/mcp-dev-server/tests/in
tegration. Status: starting.\",\"Status: running (no verification specified).\",
\"Status changed to running\",\"Process reached stable running state.\",\"Proces
s for checking status\"],\"log_file_path\":\"/var/folders/c3/r013q3_93_s4zycmx0m
dnt2h0000gn/T/mcp-pm-logs-24151/test-check-1746139857096.log.log\",\"tail_comman
d\":\"tail -f \\\"/var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-2
4151/test-check-1746139857096.log.log\\\"\",\"hint\":\"Returned all 5 new log li
nes since last check (0).\"}"}]},"jsonrpc":"2.0","id":"req-check-1"}
            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [TEST][checkStatus] Received response: {"result":{"c
ontent":[{"type":"text","text":"{\"label\":\"test-check-
1746139857096\",\"status\":\"running\",\"pid\":24202,\"command\":\"node\",\"args
\":[\"-e\",\"console.log('Process for checking status'); setInterval(() => {}, 1
000);\"],\"cwd\":\"/Users/johnlindquist/dev/mcp-dev-server/tests/integration\",\
"exitCode\":null,\"signal\":null,\"logs\":[\"Process spawned successfully (PID:
24202) in /Users/johnlindquist/dev/mcp-dev-server/tests/integration. Status: sta
rting.\",\"Status: running (no verification specified).\",\"Status changed to ru
nning\",\"Process reached stable running state.\",\"Process for checking status\
"],\"log_file_path\":\"/var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-l
ogs-24151/test-check-1746139857096.log.log\",\"tail_command\":\"tail -f \\\"/var
/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-check-174613
9857096.log.log\\\"\",\"hint\":\"Returned all 5 new log lines since last check (
0).\"}"}]},"jsonrpc":"2.0","id":"req-check-1"}
            [TEST][checkStatus] Asserting response properties...
[TEST][checkStatus] Asserting result properties...
[TEST][checkStatus] First check logs (5): [
  'Process spawned successfully (PID: 24202) in /Users/johnlindquist/dev/mcp-dev
-server/tests/integration. S
tatus: starting.',
                              'Status: running (no verification specified).',
  'Status changed to running',
  'Process reached stable running state.',
  'Process for checking status'
]
[TEST][checkStatus] Assertions passed.
[TEST][checkStatus] Sending stop request for cleanup...
[sendRequest] Sending request (ID req-stop-cleanup-check-1): {"jsonrpc":"2.0","m
ethod":"tools/call","params"
:{"name":"stop_process","arguments":{"label":"test-check-1746139857096"}},"id":"
req-stop-cleanup-check-1"}  
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Tool invoked: stop_process { params: { label: '
test-check-1746139857096', force: false } }
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Tool invoked: stop_proc
ess { params: { label: 'test
-check-1746139857096', force: false } }
                            [sendRequest][Server STDERR during request req-stop-
cleanup-check-1]: [mcp-pm test-check-1746139857096] INFO
: Tool invoked: stop_process { params: { label: 'test-check-1746139857096', forc
e: false } }                
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Stop requested for process "test-check-17461398
57096". Force: false
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Stop requested for proc
ess "test-check-174613985709
6". Force: false
                            [sendRequest][Server STDERR during request req-stop-
cleanup-check-1]: [mcp-pm test-check-1746139857096] INFO
: Stop requested for process "test-check-1746139857096". Force: false
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: [state.addLogEntry] Pushing log entry (ts: 174
6139859109): Stop requested. Force: false
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 6 
[mcp-pm test-check-1746139857096] DEBUG: [checkAndUpdateProcessStatus START] Ini
tial ProcessInfo found: true
, Status: running
                            [mcp-pm test-check-1746139857096] DEBUG: Process che
ck (kill 0): PID 24202 exists. Status remains running. 
[mcp-pm test-check-1746139857096] DEBUG: [checkAndUpdateProcessStatus END] Retur
ning ProcessInfo. Status: ru
nning
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pu
shing log entry (ts: 1746139
859109): Stop requested. Force: false
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 6 
[mcp-pm test-check-1746139857096] DEBUG: [checkAndUpdateProcessStatus START] Ini
tial ProcessInfo found: true
, Status: running
                            [mcp-pm test-check-1746139857096] DEBUG: Process che
ck (kill 0): PID 24202 exists. Status remains running. 
[mcp-pm test-check-1746139857096] DEBUG: [checkAndUpdateProcessStatus END] Retur
ning ProcessInfo. Status: ru
nning
                            [sendRequest][Server STDERR during request req-stop-
cleanup-check-1]: [mcp-pm test-check-1746139857096] DEBU
G: [state.addLogEntry] Pushing log entry (ts: 1746139859109): Stop requested. Fo
rce: false                  [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 6 
[mcp-pm test-check-1746139857096] DEBUG: [checkAndUpdateProcessStatus START] Ini
tial ProcessInfo found: true
, Status: running
                            [mcp-pm test-check-1746139857096] DEBUG: Process che
ck (kill 0): PID 24202 exists. Status remains running. 
[mcp-pm test-check-1746139857096] DEBUG: [checkAndUpdateProcessStatus END] Retur
ning ProcessInfo. Status: ru
nning
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Status changing from running to stopping 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859109): Status c
hanged to stopping
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 7 
[mcp-pm test-check-1746139857096] INFO: Attempting graceful shutdown. Sending SI
GTERM to PID 24202... 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859109): Sending 
SIGTERM...
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 8 

[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Status changing from ru
nning to stopping 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859109): Status c
hanged to stopping
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 7 
[mcp-pm test-check-1746139857096] INFO: Attempting graceful shutdown. Sending SI
GTERM to PID 24202... 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859109): Sending 
SIGTERM...
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 8
[sendRequest][Server STDERR during request req-stop-cleanup-check-1]: [mcp-pm te
st-check-1746139857096] INFO
: Status changing from running to stopping
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushing log entry (ts: 1746139859109): Status c
hanged to stopping
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 7 
[mcp-pm test-check-1746139857096] INFO: Attempting graceful shutdown. Sending SI
GTERM to PID 24202... 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859109): Sending 
SIGTERM...
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 8

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: fkill sent (SIGTERM) to 24202 

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: fkill sent (SIGTERM) t
o 24202
[sendRequest][Server STDERR during request req-stop-cleanup-check-1]: [mcp-pm te
st-check-1746139857096] DEBU
G: fkill sent (SIGTERM) to 24202
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: Waiting 3000ms for graceful shutdown... 

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: Waiting 3000ms for gra
ceful shutdown...
[sendRequest][Server STDERR during request req-stop-cleanup-check-1]: [mcp-pm te
st-check-1746139857096] DEBU
G: Waiting 3000ms for graceful shutdown...
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: [ExitHandler] Process exited. Code: 0, Signal: 
15
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: [ExitHandler] Process e
xited. Code: 0, Signal: 15
[sendRequest][Server STDERR during request req-stop-cleanup-check-1]: [mcp-pm te
st-check-1746139857096] INFO
: [ExitHandler] Process exited. Code: 0, Signal: 15
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: Closing log file stream for test-check-1746139
857096 due to exit.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushing log entry (ts: 1746139859222): --- Proc
ess Exited (Code: 0, Signal: 15) ---
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 9 

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: Closing log file strea
m for test-check-17461398570
96 due to exit.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushing log entry (ts: 1746139859222): --- Proc
ess Exited (Code: 0, Signal: 15) ---
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 9
[sendRequest][Server STDERR during request req-stop-cleanup-check-1]: [mcp-pm te
st-check-1746139857096] DEBU
G: Closing log file stream for test-check-1746139857096 due to exit.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushing log entry (ts: 1746139859222): --- Proc
ess Exited (Code: 0, Signal: 15) ---
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 9

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] INFO: Process was explicitly stopped. Final code: 0, 
signal: 15
                            [mcp-pm test-check-1746139857096] INFO: Status chang
ing from stopping to stopped 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859222): Status c
hanged to stopped
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 10 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859222): Process 
ended. Code: 0, Signal: 15
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 11 

[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Process was explicitly
stopped. Final code: 0, sign
al: 15
                            [mcp-pm test-check-1746139857096] INFO: Status chang
ing from stopping to stopped 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859222): Status c
hanged to stopped
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 10 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859222): Process 
ended. Code: 0, Signal: 15
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 11
[sendRequest][Server STDERR during request req-stop-cleanup-check-1]: [mcp-pm te
st-check-1746139857096] INFO
: Process was explicitly stopped. Final code: 0, signal: 15
                            [mcp-pm test-check-1746139857096] INFO: Status chang
ing from stopping to stopped 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859222): Status c
hanged to stopped
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 10 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139859222): Process 
ended. Code: 0, Signal: 15
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 11

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: Log file stream for test-check-1746139857096 f
inished writing and closed.
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: Log file stream for te
st-check-1746139857096 finis
hed writing and closed.
                            [sendRequest][Server STDERR during request req-stop-
cleanup-check-1]: [mcp-pm test-check-1746139857096] DEBU
G: Log file stream for test-check-1746139857096 finished writing and closed.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: [checkAndUpdateProcessStatus START] Initial Pr
ocessInfo found: true, Status: stopped
                            
[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: [checkAndUpdateProcess
Status START] Initial Proces
sInfo found: true, Status: stopped
                            [sendRequest][Server STDERR during request req-stop-
cleanup-check-1]: [mcp-pm test-check-1746139857096] DEBU
G: [checkAndUpdateProcessStatus START] Initial ProcessInfo found: true, Status:
stopped                     
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [Server STDERR RAW]: [mcp-pm test-check-174613985709
6] DEBUG: Process check: Status is stopped. No update ne
eded.
                            [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus END] Returning ProcessInfo. Status: st
opped
                            [mcp-pm test-check-1746139857096] INFO: Process 2420
2 terminated gracefully after SIGTERM. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139862222): Process 
terminated gracefully.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 12 
[mcp-pm test-check-1746139857096] INFO: Returning result for stop_process. Final
 status: stopped. PID: 24202

                            [mcp-pm test-check-1746139857096] INFO: Tool success
ful: stop_process {
  responseSummary: '{"label":"test-check-1746139857096","status":"stopped","mess
age":"Process 24202 terminat
ed gracefull...'
                            }

[Server STDERR]: [mcp-pm test-check-1746139857096] DEBUG: Process check: Status
is stopped. No update needed
.
                            [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus END] Returning ProcessInfo. Status: st
opped
                            [mcp-pm test-check-1746139857096] INFO: Process 2420
2 terminated gracefully after SIGTERM. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139862222): Process 
terminated gracefully.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 12 
[mcp-pm test-check-1746139857096] INFO: Returning result for stop_process. Final
 status: stopped. PID: 24202

                            [mcp-pm test-check-1746139857096] INFO: Tool success
ful: stop_process {
  responseSummary: '{"label":"test-check-1746139857096","status":"stopped","mess
age":"Process 24202 terminat
ed gracefull...'
                            }
[sendRequest][Server STDERR during request req-stop-cleanup-check-1]: [mcp-pm te
st-check-1746139857096] DEBU
G: Process check: Status is stopped. No update needed.
                            [mcp-pm test-check-1746139857096] DEBUG: [checkAndUp
dateProcessStatus END] Returning ProcessInfo. Status: st
opped
                            [mcp-pm test-check-1746139857096] INFO: Process 2420
2 terminated gracefully after SIGTERM. 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139862222): Process 
terminated gracefully.
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 12 
[mcp-pm test-check-1746139857096] INFO: Returning result for stop_process. Final
 status: stopped. PID: 24202

                            [mcp-pm test-check-1746139857096] INFO: Tool success
ful: stop_process {
  responseSummary: '{"label":"test-check-1746139857096","status":"stopped","mess
age":"Process 24202 terminat
ed gracefull...'
                            }

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [sendRequest] Received matching response for ID req-
stop-cleanup-check-1: {"result":{"content":[{"type":"tex
t","text":"{\"label\":\"test-check-1746139857096\",\"status\":\"stopped\",\"mess
age\":\"Process 24202 terminated gracefully after SIGTERM.\",\"pid\":24202}"}]},
"jsonrpc":"2.0","id":"req-stop-cleanup-check-1"}        
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should chec
k the status of a running process
                            [TEST][checkStatus] Cleanup stop request sent. Test
finished.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [TEST][restart] Starting test...
[TEST][restart] Starting initial process test-restart-1746139862225...
[sendRequest] Sending request (ID req-start-for-restart-test-restart-17461398622
25): {"jsonrpc":"2.0","metho
d":"tools/call","params":{"name":"start_process","arguments":{"command":"node","
args":["-e","console.log(`Restart test process started PID: ${process.pid}`); se
tInterval(() => {}, 1000);"],"workingDirectory":"/Users/johnlindquist/dev/mcp-de
v-server/tests/integration","label":"test-restart-1746139862225"}},"id":"req-sta
rt-for-restart-test-restart-1746139862225"}
                                
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] INFO: Determined label for start_process: test-rest
art-1746139862225
                            
[Server STDERR]: [mcp-pm test-restart-1746139862225] INFO: Determined label for
start_process: test-restart-
1746139862225
                            [sendRequest][Server STDERR during request req-start
-for-restart-test-restart-1746139862225]: [mcp-pm test-r
estart-1746139862225] INFO: Determined label for start_process: test-restart-174
6139862225                  
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] INFO: Tool invoked: start_process {
  params: {
    label: 'test-restart-1746139862225',
    command: 'node',
    args: [
      '-e',
      'console.log(`Restart test process started PID: ${process.pid}`); setInter
val(() => {}, 1000);'
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}
[mcp-pm test-restart-1746139862225] INFO: Starting process... Command: "node", A
rgs: [-e, console.log(`Resta
rt test process started PID: ${process.pid}`); setInterval(() => {}, 1000);], CW
D: "/Users/johnlindquist/dev/mcp-dev-server/tests/integration", Host: unknown, i
sRestart: false                                         [mcp-pm test-restart-174
6139862225] DEBUG: Verifying working directory: /Users/johnlindquist/dev/mcp-dev
-ser
ver/tests/integration
                            
[Server STDERR]: [mcp-pm test-restart-1746139862225] INFO: Tool invoked: start_p
rocess {
  params: {
    label: 'test-restart-1746139862225',
    command: 'node',
    args: [
      '-e',
      'console.log(`Restart test process started PID: ${process.pid}`); setInter
val(() => {}, 1000);'
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}
[mcp-pm test-restart-1746139862225] INFO: Starting process... Command: "node", A
rgs: [-e, console.log(`Resta
rt test process started PID: ${process.pid}`); setInterval(() => {}, 1000);], CW
D: "/Users/johnlindquist/dev/mcp-dev-server/tests/integration", Host: unknown, i
sRestart: false                                         [mcp-pm test-restart-174
6139862225] DEBUG: Verifying working directory: /Users/johnlindquist/dev/mcp-dev
-ser
ver/tests/integration
                            [sendRequest][Server STDERR during request req-start
-for-restart-test-restart-1746139862225]: [mcp-pm test-r
estart-1746139862225] INFO: Tool invoked: start_process {
                              params: {
    label: 'test-restart-1746139862225',
    command: 'node',
    args: [
      '-e',
      'console.log(`Restart test process started PID: ${process.pid}`); setInter
val(() => {}, 1000);'
    ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_timeout_ms: -1
  }
}
[mcp-pm test-restart-1746139862225] INFO: Starting process... Command: "node", A
rgs: [-e, console.log(`Resta
rt test process started PID: ${process.pid}`); setInterval(() => {}, 1000);], CW
D: "/Users/johnlindquist/dev/mcp-dev-server/tests/integration", Host: unknown, i
sRestart: false                                         [mcp-pm test-restart-174
6139862225] DEBUG: Verifying working directory: /Users/johnlindquist/dev/mcp-dev
-ser
ver/tests/integration
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] DEBUG: Working directory verified. 
[mcp-pm test-restart-1746139862225] INFO: Logging process output to: /var/folder
s/c3/r013q3_93_s4zycmx0mdnt2
h0000gn/T/mcp-pm-logs-24151/test-restart-1746139862225.log.log (mode: a)
                            [mcp-pm test-restart-1746139862225] INFO: Logging pr
ocess output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2
h0000gn/T/mcp-pm-logs-24151/test-restart-1746139862225.log.log (mode: a)
                            [mcp-pm test-restart-1746139862225] WARN: [addLogEnt
ry] Attempted to add log entry for unknown process: test
-restart-1746139862225
                            [mcp-pm test-restart-1746139862225] DEBUG: Attemptin
g to spawn PTY with command: node 

[Server STDERR]: [mcp-pm test-restart-1746139862225] DEBUG: Working directory ve
rified. 
[mcp-pm test-restart-1746139862225] INFO: Logging process output to: /var/folder
s/c3/r013q3_93_s4zycmx0mdnt2
h0000gn/T/mcp-pm-logs-24151/test-restart-1746139862225.log.log (mode: a)
                            [mcp-pm test-restart-1746139862225] INFO: Logging pr
ocess output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2
h0000gn/T/mcp-pm-logs-24151/test-restart-1746139862225.log.log (mode: a)
                            [mcp-pm test-restart-1746139862225] WARN: [addLogEnt
ry] Attempted to add log entry for unknown process: test
-restart-1746139862225
                            [mcp-pm test-restart-1746139862225] DEBUG: Attemptin
g to spawn PTY with command: node
[sendRequest][Server STDERR during request req-start-for-restart-test-restart-17
46139862225]: [mcp-pm test-r
estart-1746139862225] DEBUG: Working directory verified.
                            [mcp-pm test-restart-1746139862225] INFO: Logging pr
ocess output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2
h0000gn/T/mcp-pm-logs-24151/test-restart-1746139862225.log.log (mode: a)
                            [mcp-pm test-restart-1746139862225] INFO: Logging pr
ocess output to: /var/folders/c3/r013q3_93_s4zycmx0mdnt2
h0000gn/T/mcp-pm-logs-24151/test-restart-1746139862225.log.log (mode: a)
                            [mcp-pm test-restart-1746139862225] WARN: [addLogEnt
ry] Attempted to add log entry for unknown process: test
-restart-1746139862225
                            [mcp-pm test-restart-1746139862225] DEBUG: Attemptin
g to spawn PTY with command: node

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] DEBUG: PTY process spawned with PID: 24426 
[mcp-pm test-restart-1746139862225] INFO: PTY process created successfully, PID:
 24426 
[mcp-pm test-restart-1746139862225] DEBUG: [updateProcessStatus] Status unchange
d: starting 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Proces
s spawned successfully (PID: 24426) in /Users/johnlindquist/dev/mcp-dev-server/t
ests/integrati              [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-restart-1746139862225] INFO: No verification pattern provided. Init
ial status: running. 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Status
: running (no verification specified).
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 2 

[Server STDERR]: [mcp-pm test-restart-1746139862225] DEBUG: PTY process spawned
with PID: 24426 
[mcp-pm test-restart-1746139862225] INFO: PTY process created successfully, PID:
 24426 
[mcp-pm test-restart-1746139862225] DEBUG: [updateProcessStatus] Status unchange
d: starting 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Proces
s spawned successfully (PID: 24426) in /Users/johnlindquist/dev/mcp-dev-server/t
ests/integrati              [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-restart-1746139862225] INFO: No verification pattern provided. Init
ial status: running. 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Status
: running (no verification specified).
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 2
[sendRequest][Server STDERR during request req-start-for-restart-test-restart-17
46139862225]: [mcp-pm test-r
estart-1746139862225] DEBUG: PTY process spawned with PID: 24426
                            [mcp-pm test-restart-1746139862225] INFO: PTY proces
s created successfully, PID: 24426 
[mcp-pm test-restart-1746139862225] DEBUG: [updateProcessStatus] Status unchange
d: starting 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Proces
s spawned successfully (PID: 24426) in /Users/johnlindquist/dev/mcp-dev-server/t
ests/integrati              [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-restart-1746139862225] INFO: No verification pattern provided. Init
ial status: running. 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Status
: running (no verification specified).
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 2

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] INFO: Status changing from starting to running 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Status
 changed to running
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-restart-1746139862225] INFO: Process reached stable running state. 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Proces
s reached stable running state.
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 4 
[mcp-pm test-restart-1746139862225] DEBUG: Waiting for logs to settle (Pause: 20
00ms, Timeout: 15000ms)... 

[Server STDERR]: [mcp-pm test-restart-1746139862225] INFO: Status changing from
starting to running 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Status
 changed to running
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-restart-1746139862225] INFO: Process reached stable running state. 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Proces
s reached stable running state.
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 4 
[mcp-pm test-restart-1746139862225] DEBUG: Waiting for logs to settle (Pause: 20
00ms, Timeout: 15000ms)...
[sendRequest][Server STDERR during request req-start-for-restart-test-restart-17
46139862225]: [mcp-pm test-r
estart-1746139862225] INFO: Status changing from starting to running
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushing log entry (ts: 1746139862229): Status
 changed to running
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-restart-1746139862225] INFO: Process reached stable running state. 
[mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139862229): Proces
s reached stable running state.
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 4 
[mcp-pm test-restart-1746139862225] DEBUG: Waiting for logs to settle (Pause: 20
00ms, Timeout: 15000ms)...

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] DEBUG: [state.addLogEntry] Pushing log entry (ts: 1
746139862268): Restart test process started PID: 24426
                            
[Server STDERR]: [mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry]
Pushing log entry (ts: 17461
39862268): Restart test process started PID: 24426
                            [sendRequest][Server STDERR during request req-start
-for-restart-test-restart-1746139862225]: [mcp-pm test-r
estart-1746139862225] DEBUG: [state.addLogEntry] Pushing log entry (ts: 17461398
62268): Restart test process started PID: 24426
                                                        
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] DEBUG: [state.addLogEntry] Pushed entry. New log co
unt: 5
                            
[Server STDERR]: [mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry]
Pushed entry. New log count:
 5
                            [sendRequest][Server STDERR during request req-start
-for-restart-test-restart-1746139862225]: [mcp-pm test-r
estart-1746139862225] DEBUG: [state.addLogEntry] Pushed entry. New log count: 5
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] DEBUG: Logs settled after 2000ms pause. 

[Server STDERR]: [mcp-pm test-restart-1746139862225] DEBUG: Logs settled after 2
000ms pause.
[sendRequest][Server STDERR during request req-start-for-restart-test-restart-17
46139862225]: [mcp-pm test-r
estart-1746139862225] DEBUG: Logs settled after 2000ms pause.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] DEBUG: [_waitForLogSettleOrTimeout] Disposing tempo
rary exit listener.
                            [mcp-pm test-restart-1746139862225] DEBUG: Log settl
e wait completed. 
[mcp-pm test-restart-1746139862225] INFO: Final status for payload construction:
 running 

[Server STDERR]: [mcp-pm test-restart-1746139862225] DEBUG: [_waitForLogSettleOr
Timeout] Disposing temporary
 exit listener.
                            [mcp-pm test-restart-1746139862225] DEBUG: Log settl
e wait completed. 
[mcp-pm test-restart-1746139862225] INFO: Final status for payload construction:
 running
[sendRequest][Server STDERR during request req-start-for-restart-test-restart-17
46139862225]: [mcp-pm test-r
estart-1746139862225] DEBUG: [_waitForLogSettleOrTimeout] Disposing temporary ex
it listener.                [mcp-pm test-restart-1746139862225] DEBUG: Log settl
e wait completed. 
[mcp-pm test-restart-1746139862225] INFO: Final status for payload construction:
 running

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [Server STDERR RAW]: [mcp-pm test-restart-1746139862
225] ERROR: Tool execution failed: start_process { error
: 'line.trim is not a function' }
                            
[Server STDERR]: [mcp-pm test-restart-1746139862225] ERROR: Tool execution faile
d: start_process { error: 'l
ine.trim is not a function' }
                            [sendRequest][Server STDERR during request req-start
-for-restart-test-restart-1746139862225]: [mcp-pm test-r
estart-1746139862225] ERROR: Tool execution failed: start_process { error: 'line
.trim is not a function' }  
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [sendRequest] Received matching response for ID req-
start-for-restart-test-restart-1746139862225: {"result":
{"isError":true,"content":[{"type":"text","text":"{\n  \"error\": \"Tool executi
on failed: line.trim is not a function\"\n}"}]},"jsonrpc":"2.0","id":"req-start-
for-restart-test-restart-1746139862225"}                
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should rest
art a running process
                            [TEST][restart] Initial process test-restart-1746139
862225 started.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [TEST][checkLogsFilter] Starting test...
[TEST][checkLogsFilter] Starting process test-log-filter-1746139864232...
[sendRequest] Sending request (ID req-start-for-log-filter-test-log-filter-17461
39864232): {"jsonrpc":"2.0",
"method":"tools/call","params":{"name":"start_process","arguments":{"command":"n
ode","args":["-e","console.log('Start'); let c=0; const i = setInterval(() => {
console.log('Log: '+c++); if (c > 10) clearInterval(i); }, 500);"],"workingDirec
tory":"/Users/johnlindquist/dev/mcp-dev-server/tests/integration","label":"test-
log-filter-1746139864232","verification_pattern":"Start","verification_timeout_m
s":5000}},"id":"req-start-for-log-filter-test-log-filter-1746139864232"}
                                                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: Determined label for start_process: test-l
og-filter-1746139864232
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Determined label f
or start_process: test-log-f
ilter-1746139864232
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] INFO: Determined label for start_process: test-lo
g-filter-1746139864232      
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: Tool invoked: start_process {
  params: {
    label: 'test-log-filter-1746139864232',
    command: 'node',
    args: [
      '-e',
      "console.log('Start'); let c=0; const i = setInterval(() => { console.log(
'Log: '+c++); if (c > 10) cl
earInterval(i); }, 500);"
                                ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_pattern: 'Start',
    verification_timeout_ms: 5000
  }
}

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Tool invoked: star
t_process {
  params: {
    label: 'test-log-filter-1746139864232',
    command: 'node',
    args: [
      '-e',
      "console.log('Start'); let c=0; const i = setInterval(() => { console.log(
'Log: '+c++); if (c > 10) cl
earInterval(i); }, 500);"
                                ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_pattern: 'Start',
    verification_timeout_ms: 5000
  }
}
[sendRequest][Server STDERR during request req-start-for-log-filter-test-log-fil
ter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] INFO: Tool invoked: start_process {
                              params: {
    label: 'test-log-filter-1746139864232',
    command: 'node',
    args: [
      '-e',
      "console.log('Start'); let c=0; const i = setInterval(() => { console.log(
'Log: '+c++); if (c > 10) cl
earInterval(i); }, 500);"
                                ],
    workingDirectory: '/Users/johnlindquist/dev/mcp-dev-server/tests/integration
',
    host: 'unknown',
    verification_pattern: 'Start',
    verification_timeout_ms: 5000
  }
}

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: Starting process... Command: "node", Args:
 [-e, console.log('Start'); let c=0; const i = setInterval(() => { console.log('
Log: '+c++); if (c > 10) clearInterval(i); }, 500);], CWD: "/Users/johnlindquist
/dev/mcp-dev-server/tests/integration", Host: unknown, isRestart: false

    [mcp-pm test-log-filter-1746139864232] DEBUG: Verifying working directory: /
Users/johnlindquist/dev/mcp-dev-
server/tests/integration
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Workin
g directory verified. 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Starting process..
. Command: "node", Args: [-e
, console.log('Start'); let c=0; const i = setInterval(() => { console.log('Log:
 '+c++); if (c > 10) clearInterval(i); }, 500);], CWD: "/Users/johnlindquist/dev
/mcp-dev-server/tests/integration", Host: unknown, isRestart: false

    [mcp-pm test-log-filter-1746139864232] DEBUG: Verifying working directory: /
Users/johnlindquist/dev/mcp-dev-
server/tests/integration
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Workin
g directory verified.
[sendRequest][Server STDERR during request req-start-for-log-filter-test-log-fil
ter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] INFO: Starting process... Command: "node", Args:
[-e, console.log('Start'); let c=0; const i = setInterval(() => { console.log('L
og: '+c++); if (c > 10) clearInterval(i); }, 500);], CWD: "/Users/johnlindquist/
dev/mcp-dev-server/tests/integration", Host: unknown, isRestart: false
    [mcp-pm test-log-filter-1746139864232] DEBUG: Verifying working directory: /
Users/johnlindquist/dev/mcp-dev-
server/tests/integration
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Workin
g directory verified.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: Logging process output to: /var/folders/c3
/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-log-filter-174613986423
2.log.log (mode: a)         
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Logging process ou
tput to: /var/folders/c3/r01
3q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-log-filter-1746139864232.lo
g.log (mode: a)             [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] INFO: Logging process output to: /var/folders/c3/
r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-log-filter-1746139864232
.log.log (mode: a)                                      
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: Logging process output to: /var/folders/c3
/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-log-filter-174613986423
2.log.log (mode: a)         [mcp-pm test-log-filter-1746139864232] WARN: [addLog
Entry] Attempted to add log entry for unknown process: t
est-log-filter-1746139864232
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Attemp
ting to spawn PTY with command: node 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Logging process ou
tput to: /var/folders/c3/r01
3q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-log-filter-1746139864232.lo
g.log (mode: a)             [mcp-pm test-log-filter-1746139864232] WARN: [addLog
Entry] Attempted to add log entry for unknown process: t
est-log-filter-1746139864232
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Attemp
ting to spawn PTY with command: node
[sendRequest][Server STDERR during request req-start-for-log-filter-test-log-fil
ter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] INFO: Logging process output to: /var/folders/c3/
r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-log-filter-1746139864232
.log.log (mode: a)                                      [mcp-pm test-log-filter-
1746139864232] WARN: [addLogEntry] Attempted to add log entry for unknown proces
s: t
est-log-filter-1746139864232
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Attemp
ting to spawn PTY with command: node

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: PTY process spawned with PID: 24465 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: PTY process spawn
ed with PID: 24465
[sendRequest][Server STDERR during request req-start-for-log-filter-test-log-fil
ter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: PTY process spawned with PID: 24465
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: PTY process created successfully, PID: 244
65
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [updat
eProcessStatus] Status unchanged: starting 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139864234): Pro
cess spawned successfully (PID: 24465) in /Users/johnlindquist/dev/mcp-dev-serve
r/tests/integrati           [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-log-filter-1746139864232] INFO: Verification required: Pattern /Sta
rt/, Timeout: 5000ms 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139864234): Sta
tus: verifying. Waiting for pattern or timeout.
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 2 
[mcp-pm test-log-filter-1746139864232] INFO: Status changing from starting to ve
rifying 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: PTY process create
d successfully, PID: 24465 
[mcp-pm test-log-filter-1746139864232] DEBUG: [updateProcessStatus] Status uncha
nged: starting 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139864234): Pro
cess spawned successfully (PID: 24465) in /Users/johnlindquist/dev/mcp-dev-serve
r/tests/integrati           [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-log-filter-1746139864232] INFO: Verification required: Pattern /Sta
rt/, Timeout: 5000ms 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139864234): Sta
tus: verifying. Waiting for pattern or timeout.
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 2 
[mcp-pm test-log-filter-1746139864232] INFO: Status changing from starting to ve
rifying
[sendRequest][Server STDERR during request req-start-for-log-filter-test-log-fil
ter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] INFO: PTY process created successfully, PID: 2446
5                           [mcp-pm test-log-filter-1746139864232] DEBUG: [updat
eProcessStatus] Status unchanged: starting 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139864234): Pro
cess spawned successfully (PID: 24465) in /Users/johnlindquist/dev/mcp-dev-serve
r/tests/integrati           [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 1 
[mcp-pm test-log-filter-1746139864232] INFO: Verification required: Pattern /Sta
rt/, Timeout: 5000ms 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139864234): Sta
tus: verifying. Waiting for pattern or timeout.
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 2 
[mcp-pm test-log-filter-1746139864232] INFO: Status changing from starting to ve
rifying

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139864234): Status changed to verifying
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-log-filter-1746139864232] DEBUG: Waiting for verification process t
o complete (match, timeout, 
or exit)...
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139864234): Status changed to verifying
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-log-filter-1746139864232] DEBUG: Waiting for verification process t
o complete (match, timeout, 
or exit)...
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log entry (ts:
 1746139864234): Status changed to verifying
                                                        [mcp-pm test-log-filter-
1746139864232] DEBUG: [state.addLogEntry] Pushed entry. New log count: 3 
[mcp-pm test-log-filter-1746139864232] DEBUG: Waiting for verification process t
o complete (match, timeout, 
or exit)...
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139864264): Start
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139864264): Start
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log entry (ts:
 1746139864264): Start      
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 4
                            [mcp-pm test-log-filter-1746139864232] INFO: Verific
ation pattern matched. 
[mcp-pm test-log-filter-1746139864232] DEBUG: Verification process completed. 
[mcp-pm test-log-filter-1746139864232] INFO: Verification successful (pattern ma
tched). 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 4
                            [mcp-pm test-log-filter-1746139864232] INFO: Verific
ation pattern matched. 
[mcp-pm test-log-filter-1746139864232] DEBUG: Verification process completed. 
[mcp-pm test-log-filter-1746139864232] INFO: Verification successful (pattern ma
tched).
[sendRequest][Server STDERR during request req-start-for-log-filter-test-log-fil
ter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushed entry. New log
count: 4                    [mcp-pm test-log-filter-1746139864232] INFO: Verific
ation pattern matched. 
[mcp-pm test-log-filter-1746139864232] DEBUG: Verification process completed. 
[mcp-pm test-log-filter-1746139864232] INFO: Verification successful (pattern ma
tched).

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139864264): Verification successful (pattern matched).
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 5 
[mcp-pm test-log-filter-1746139864232] DEBUG: Waiting for logs to settle (Pause:
 2000ms, Timeout: 15000ms)..
.
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139864264): Verification successful (pattern matched).
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 5 
[mcp-pm test-log-filter-1746139864232] DEBUG: Waiting for logs to settle (Pause:
 2000ms, Timeout: 15000ms)..
.
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log entry (ts:
 1746139864264): Verification successful (pattern matched).
                                                        [mcp-pm test-log-filter-
1746139864232] DEBUG: [state.addLogEntry] Pushed entry. New log count: 5 
[mcp-pm test-log-filter-1746139864232] DEBUG: Waiting for logs to settle (Pause:
 2000ms, Timeout: 15000ms)..
.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139864765): Log: 0
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139864765): Log: 0
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log entry (ts:
 1746139864765): Log: 0     
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 6
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 6
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushed entry. New log
count: 6                    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139865265): Log: 1
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139865265): Log: 1
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log entry (ts:
 1746139865265): Log: 1     
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 7
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 7
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushed entry. New log
count: 7                    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139865766): Log: 2
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139865766): Log: 2
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log entry (ts:
 1746139865766): Log: 2     
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 8
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 8
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushed entry. New log
count: 8                    
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: Logs settled after 2000ms pause. 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: Logs settled afte
r 2000ms pause.
[sendRequest][Server STDERR during request req-start-for-log-filter-test-log-fil
ter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: Logs settled after 2000ms pause.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [_waitForLogSettleOrTimeout] Disposing te
mporary exit listener.
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Log se
ttle wait completed. 
[mcp-pm test-log-filter-1746139864232] INFO: Final status for payload constructi
on: verifying 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [_waitForLogSettl
eOrTimeout] Disposing tempor
ary exit listener.
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Log se
ttle wait completed. 
[mcp-pm test-log-filter-1746139864232] INFO: Final status for payload constructi
on: verifying
[sendRequest][Server STDERR during request req-start-for-log-filter-test-log-fil
ter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] DEBUG: [_waitForLogSettleOrTimeout] Disposing tem
porary exit listener.       [mcp-pm test-log-filter-1746139864232] DEBUG: Log se
ttle wait completed. 
[mcp-pm test-log-filter-1746139864232] INFO: Final status for payload constructi
on: verifying

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] ERROR: Tool execution failed: start_process { er
ror: 'line.trim is not a function' }
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] ERROR: Tool execution fa
iled: start_process { error:
 'line.trim is not a function' }
                            [sendRequest][Server STDERR during request req-start
-for-log-filter-test-log-filter-1746139864232]: [mcp-pm 
test-log-filter-1746139864232] ERROR: Tool execution failed: start_process { err
or: 'line.trim is not a function' }
                                                        
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [sendRequest] Received matching response for ID req-
start-for-log-filter-test-log-filter-1746139864232: {"re
sult":{"isError":true,"content":[{"type":"text","text":"{\n  \"error\": \"Tool e
xecution failed: line.trim is not a function\"\n}"}]},"jsonrpc":"2.0","id":"req-
start-for-log-filter-test-log-filter-1746139864232"}    
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [TEST][checkLogsFilter] Process test-log-filter-1746
139864232 started response received.
[TEST][checkLogsFilter] Waiting 4000ms for initial logs and status update...

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139866265): Log: 3
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139866265): Log: 3
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 9
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 9
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139866767): Log: 4
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139866767): Log: 4
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 10
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 10
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139867269): Log: 5
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139867269): Log: 5
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 11
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 11
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139867769): Log: 6
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139867769): Log: 6
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 12
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 12
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139868270): Log: 7
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 13 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139868270): Log: 7
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 13

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139868771): Log: 8
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139868771): Log: 8
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 14
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 14
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139869273): Log: 9
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139869273): Log: 9
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 15
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 15
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushing log entry (ts
: 1746139869774): Log: 10
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushing log entry (ts: 17
46139869774): Log: 10
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: [state.addLogEntry] Pushed entry. New log
 count: 16
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntr
y] Pushed entry. New log cou
nt: 16
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: [ExitHandler] Process exited. Code: 0, Sig
nal: 0
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: [ExitHandler] Proc
ess exited. Code: 0, Signal:
 0
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: Closing log file stream for test-log-filt
er-1746139864232 due to exit.
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushing log entry (ts: 1746139869781): ---
 Process Exited (Code: 0, Signal: 0) ---
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 17 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: Closing log file
stream for test-log-filter-1
746139864232 due to exit.
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushing log entry (ts: 1746139869781): ---
 Process Exited (Code: 0, Signal: 0) ---
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 17

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: Process exited cleanly (code 0) during ver
ifying phase. _startProcess will determine final payload status.
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Process exited cle
anly (code 0) during verifyi
ng phase. _startProcess will determine final payload status.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: Log file stream for test-log-filter-17461
39864232 finished writing and closed.
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: Log file stream f
or test-log-filter-174613986
4232 finished writing and closed.
                            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [TEST][checkLogsFilter] Initial wait complete.
[TEST][checkLogsFilter] Sending first check_process_status for test-log-filter-1
746139864232...
[sendRequest] Sending request (ID req-check1-log-filter-test-log-filter-17461398
64232): {"jsonrpc":"2.0","me
thod":"tools/call","params":{"name":"check_process_status","arguments":{"label":
"test-log-filter-1746139864232","log_lines":100}},"id":"req-check1-log-filter-te
st-log-filter-1746139864232"}                           
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: Tool invoked: check_process_status { param
s: { label: 'test-log-filter-1746139864232', log_lines: 100 } }
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Tool invoked: chec
k_process_status { params: {
 label: 'test-log-filter-1746139864232', log_lines: 100 } }
                            [sendRequest][Server STDERR during request req-check
1-log-filter-test-log-filter-1746139864232]: [mcp-pm tes
t-log-filter-1746139864232] INFO: Tool invoked: check_process_status { params: {
 label: 'test-log-filter-1746139864232', log_lines: 100 } }
                                                        
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: Tool invoked: check_process_status { para
ms: { label: 'test-log-filter-1746139864232', log_lines: 100 } }
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [check
AndUpdateProcessStatus START] Initial ProcessInfo found:
 true, Status: verifying
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: Tool invoked: che
ck_process_status { params: 
{ label: 'test-log-filter-1746139864232', log_lines: 100 } }
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [check
AndUpdateProcessStatus START] Initial ProcessInfo found:
 true, Status: verifying
                            [sendRequest][Server STDERR during request req-check
1-log-filter-test-log-filter-1746139864232]: [mcp-pm tes
t-log-filter-1746139864232] DEBUG: Tool invoked: check_process_status { params:
{ label: 'test-log-filter-1746139864232', log_lines: 100 } }
                                                        [mcp-pm test-log-filter-
1746139864232] DEBUG: [checkAndUpdateProcessStatus START] Initial ProcessInfo fo
und:
 true, Status: verifying
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] WARN: Process check (kill 0): PID 24465 not foun
d (ESRCH). Updating status to crashed.
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] WARN: Process check (kil
l 0): PID 24465 not found (E
SRCH). Updating status to crashed.
                            [sendRequest][Server STDERR during request req-check
1-log-filter-test-log-filter-1746139864232]: [mcp-pm tes
t-log-filter-1746139864232] WARN: Process check (kill 0): PID 24465 not found (E
SRCH). Updating status to crashed.
                                                        
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] INFO: Status changing from verifying to crashed 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139870268): Sta
tus changed to crashed
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 18 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139870268): Pro
cess ended. Code: 0, Signal: 0
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 19 
[mcp-pm test-log-filter-1746139864232] DEBUG: [checkAndUpdateProcessStatus END]
Returning ProcessInfo. Statu
s: crashed
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Filter
ing logs. Total logs available: 19. Filtering for timest
amp > 0
                            
[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Status changing fr
om verifying to crashed 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139870268): Sta
tus changed to crashed
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 18 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139870268): Pro
cess ended. Code: 0, Signal: 0
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 19 
[mcp-pm test-log-filter-1746139864232] DEBUG: [checkAndUpdateProcessStatus END]
Returning ProcessInfo. Statu
s: crashed
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Filter
ing logs. Total logs available: 19. Filtering for timest
amp > 0
                            [sendRequest][Server STDERR during request req-check
1-log-filter-test-log-filter-1746139864232]: [mcp-pm tes
t-log-filter-1746139864232] INFO: Status changing from verifying to crashed
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushing log entry (ts: 1746139870268): Sta
tus changed to crashed
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 18 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139870268): Pro
cess ended. Code: 0, Signal: 0
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 19 
[mcp-pm test-log-filter-1746139864232] DEBUG: [checkAndUpdateProcessStatus END]
Returning ProcessInfo. Statu
s: crashed
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Filter
ing logs. Total logs available: 19. Filtering for timest
amp > 0
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [Server STDERR RAW]: [mcp-pm test-log-filter-1746139
864232] DEBUG: Found 19 new log entries. 
[mcp-pm test-log-filter-1746139864232] DEBUG: Updating lastLogTimestampReturned
in process state to 17461398
70268
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Reques
ted log lines: 100 (Default: 20) 
[mcp-pm test-log-filter-1746139864232] DEBUG: Returning 19 raw log lines (limite
d by request). 
[mcp-pm test-log-filter-1746139864232] INFO: check_process_status returning fina
l status: crashed. New logs 
returned: 19. New lastLogTimestamp: 1746139870268
                            [mcp-pm test-log-filter-1746139864232] INFO: Tool su
ccessful: check_process_status {
  responseSummary: '{"label":"test-log-filter-1746139864232","status":"crashed",
"pid":24465,"command":"node"
,"args":["-e...'
                            }

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] DEBUG: Found 19 new log
entries. 
[mcp-pm test-log-filter-1746139864232] DEBUG: Updating lastLogTimestampReturned
in process state to 17461398
70268
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Reques
ted log lines: 100 (Default: 20) 
[mcp-pm test-log-filter-1746139864232] DEBUG: Returning 19 raw log lines (limite
d by request). 
[mcp-pm test-log-filter-1746139864232] INFO: check_process_status returning fina
l status: crashed. New logs 
returned: 19. New lastLogTimestamp: 1746139870268
                            [mcp-pm test-log-filter-1746139864232] INFO: Tool su
ccessful: check_process_status {
  responseSummary: '{"label":"test-log-filter-1746139864232","status":"crashed",
"pid":24465,"command":"node"
,"args":["-e...'
                            }
[sendRequest][Server STDERR during request req-check1-log-filter-test-log-filter
-1746139864232]: [mcp-pm tes
t-log-filter-1746139864232] DEBUG: Found 19 new log entries.
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Updati
ng lastLogTimestampReturned in process state to 17461398
70268
                            [mcp-pm test-log-filter-1746139864232] DEBUG: Reques
ted log lines: 100 (Default: 20) 
[mcp-pm test-log-filter-1746139864232] DEBUG: Returning 19 raw log lines (limite
d by request). 
[mcp-pm test-log-filter-1746139864232] INFO: check_process_status returning fina
l status: crashed. New logs 
returned: 19. New lastLogTimestamp: 1746139870268
                            [mcp-pm test-log-filter-1746139864232] INFO: Tool su
ccessful: check_process_status {
  responseSummary: '{"label":"test-log-filter-1746139864232","status":"crashed",
"pid":24465,"command":"node"
,"args":["-e...'
                            }

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [sendRequest] Received matching response for ID req-
check1-log-filter-test-log-filter-1746139864232: {"resul
t":{"content":[{"type":"text","text":"{\"label\":\"test-log-filter-1746139864232
\",\"status\":\"crashed\",\"pid\":24465,\"command\":\"node\",\"args\":[\"-e\",\"
console.log('Start'); let c=0; const i = setInterval(() => { console.log('Log: '
+c++); if (c > 10) clearInterval(i); }, 500);\"],\"cwd\":\"/Users/johnlindquist/
dev/mcp-dev-server/tests/integration\",\"exitCode\":0,\"signal\":\"0\",\"logs\":
[\"Process spawned successfully (PID: 24465) in /Users/johnlindquist/dev/mcp-dev
-server/tests/integration. Status: starting.\",\"Status: verifying. Waiting for
pattern or timeout.\",\"Status changed to verifying\",\"Start\",\"Verification s
uccessful (pattern matched).\",\"Log: 0\",\"Log: 1\",\"Log: 2\",\"Log: 3\",\"Log
: 4\",\"Log: 5\",\"Log: 6\",\"Log: 7\",\"Log: 8\",\"Log: 9\",\"Log: 10\",\"--- P
rocess Exited (Code: 0, Signal: 0) ---\",\"Status changed to crashed\",\"Process
 ended. Code: 0, Signal: 0\"],\"log_file_path\":\"/var/folders/c3/r013q3_93_s4zy
cmx0mdnt2h0000gn/T/mcp-pm-logs-24151/test-log-filter-1746139864232.log.log\",\"t
ail_command\":\"tail -f \\\"/var/folders/c3/r013q3_93_s4zycmx0mdnt2h0000gn/T/mcp
-pm-logs-24151/test-log-filter-1746139864232.log.log\\\"\",\"hint\":\"Returned a
ll 19 new log lines since last check (0).\"}"}]},"jsonrpc":"2.0","id":"req-check
1-log-filter-test-log-filter-1746139864232"}
                                            
stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration) > should filt
er logs correctly on repeated checks of an active process
                            [TEST][checkLogsFilter] Received first check respons
e.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[TEST] AfterAll: Tearing down server...
[TEST] Terminating server process...
[TEST] Sent SIGTERM to server process.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm] INFO: Initiating graceful shutdown... 
[mcp-pm] INFO: Cleared zombie check interval. 
[mcp-pm] INFO: Stopping all managed processes on exit... 
[mcp-pm test-process-1746139854851] INFO: Attempting to stop process test-proces
s-1746139854851 (PID: 24156)
...
                            [mcp-pm test-process-1746139854851] INFO: Status cha
nging from stopped to stopping 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139870272): Status
 changed to stopping
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 10 

[Server STDERR]: [mcp-pm] INFO: Initiating graceful shutdown... 
[mcp-pm] INFO: Cleared zombie check interval. 
[mcp-pm] INFO: Stopping all managed processes on exit... 
[mcp-pm test-process-1746139854851] INFO: Attempting to stop process test-proces
s-1746139854851 (PID: 24156)
...
                            [mcp-pm test-process-1746139854851] INFO: Status cha
nging from stopped to stopping 
[mcp-pm test-process-1746139854851] DEBUG: [state.addLogEntry] Pushing log entry
 (ts: 1746139870272): Status
 changed to stopping
                            [mcp-pm test-process-1746139854851] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 10

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm test-list-1746139855087] INFO: Attempting to stop p
rocess test-list-17461398550
87 (PID: 24160)...
                            [mcp-pm test-list-1746139855087] INFO: Status changi
ng from running to stopping 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139870275): Status ch
anged to stopping
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 6 

[Server STDERR]: [mcp-pm test-list-1746139855087] INFO: Attempting to stop proce
ss test-list-1746139855087 (
PID: 24160)...
                            [mcp-pm test-list-1746139855087] INFO: Status changi
ng from running to stopping 
[mcp-pm test-list-1746139855087] DEBUG: [state.addLogEntry] Pushing log entry (t
s: 1746139870275): Status ch
anged to stopping
                            [mcp-pm test-list-1746139855087] DEBUG: [state.addLo
gEntry] Pushed entry. New log count: 6

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm test-list-1746139855087] INFO: Closing log stream f
or test-list-1746139855087 d
uring server shutdown.
                            
[Server STDERR]: [mcp-pm test-list-1746139855087] INFO: Closing log stream for t
est-list-1746139855087 durin
g server shutdown.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm test-check-1746139857096] INFO: Attempting to stop
process test-check-174613985
7096 (PID: 24202)...
                            [mcp-pm test-check-1746139857096] INFO: Status chang
ing from stopped to stopping 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139870277): Status c
hanged to stopping
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 13 

[Server STDERR]: [mcp-pm test-check-1746139857096] INFO: Attempting to stop proc
ess test-check-1746139857096
 (PID: 24202)...
                            [mcp-pm test-check-1746139857096] INFO: Status chang
ing from stopped to stopping 
[mcp-pm test-check-1746139857096] DEBUG: [state.addLogEntry] Pushing log entry (
ts: 1746139870277): Status c
hanged to stopping
                            [mcp-pm test-check-1746139857096] DEBUG: [state.addL
ogEntry] Pushed entry. New log count: 13

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm test-restart-1746139862225] INFO: Attempting to sto
p process test-restart-17461
39862225 (PID: 24426)...
                            [mcp-pm test-restart-1746139862225] INFO: Status cha
nging from running to stopping 

[Server STDERR]: [mcp-pm test-restart-1746139862225] INFO: Attempting to stop pr
ocess test-restart-174613986
2225 (PID: 24426)...
                            [mcp-pm test-restart-1746139862225] INFO: Status cha
nging from running to stopping

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEnt
ry] Pushing log entry (ts: 1
746139870278): Status changed to stopping
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 6 

[Server STDERR]: [mcp-pm test-restart-1746139862225] DEBUG: [state.addLogEntry]
Pushing log entry (ts: 17461
39870278): Status changed to stopping
                            [mcp-pm test-restart-1746139862225] DEBUG: [state.ad
dLogEntry] Pushed entry. New log count: 6

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm test-restart-1746139862225] INFO: Closing log strea
m for test-restart-174613986
2225 during server shutdown.
                            
[Server STDERR]: [mcp-pm test-restart-1746139862225] INFO: Closing log stream fo
r test-restart-1746139862225
 during server shutdown.
                            
stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm test-log-filter-1746139864232] INFO: Attempting to
stop process test-log-filter
-1746139864232 (PID: 24465)...
                            [mcp-pm test-log-filter-1746139864232] INFO: Status
changing from crashed to stopping 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139870279): Sta
tus changed to stopping
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 20 

[Server STDERR]: [mcp-pm test-log-filter-1746139864232] INFO: Attempting to stop
 process test-log-filter-174
6139864232 (PID: 24465)...
                            [mcp-pm test-log-filter-1746139864232] INFO: Status
changing from crashed to stopping 
[mcp-pm test-log-filter-1746139864232] DEBUG: [state.addLogEntry] Pushing log en
try (ts: 1746139870279): Sta
tus changed to stopping
                            [mcp-pm test-log-filter-1746139864232] DEBUG: [state
.addLogEntry] Pushed entry. New log count: 20

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm] INFO: Issued stop commands for all processes. 
[mcp-pm] INFO: Cleanup complete. Exiting. 

[Server STDERR]: [mcp-pm] INFO: Issued stop commands for all processes. 
[mcp-pm] INFO: Cleanup complete. Exiting.

stderr | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[Server STDERR RAW]: [mcp-pm] INFO: Process exiting... 

[Server STDERR]: [mcp-pm] INFO: Process exiting...

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[TEST] Server process exited. Code: 0, Signal: null
[TEST] Server stdio streams closed.

stdout | tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdi
o Integration)
[TEST] Server process terminated gracefully after SIGTERM.
[TEST] AfterAll: Teardown complete.

 ❯ tests/integration/mcp-server.test.ts (7 tests | 5 failed) 16195ms
   × MCP Process Manager Server (Stdio Integration) > should list zero processes
 initially 8ms
     → expected { processList: [] } to be an instance of Array
   ✓ MCP Process Manager Server (Stdio Integration) > should respond successfull
y to health_check 1ms
   × MCP Process Manager Server (Stdio Integration) > should start a simple proc
ess and receive confirmation
 236ms
                                 → expected undefined to be 'test-process-174613
9854851' // Object.is equality
   × MCP Process Manager Server (Stdio Integration) > should list one running pr
ocess after starting it 2009
ms
                                 → expected { processList: [ { …(12) }, …(1) ] }
 to be an instance of Array
   ✓ MCP Process Manager Server (Stdio Integration) > should check the status of
 a running process  5128ms
   × MCP Process Manager Server (Stdio Integration) > should restart a running p
rocess 2008ms
     → actual value must be number or bigint, received "undefined"
   × MCP Process Manager Server (Stdio Integration) > should filter logs correct
ly on repeated checks of an 
active process 6039ms
                                 → expected [ 'running', 'stopped' ] to include
'crashed'

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 5 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdio
Integration) > should list z
ero processes initially
                            AssertionError: expected { processList: [] } to be a
n instance of Array
 ❯ tests/integration/mcp-server.test.ts:390:23
    388|    }
    389| 
    390|    expect(listResult).toBeInstanceOf(Array);
       |                       ^
    391|    expect(listResult?.length).toBe(0);
    392|    console.log("[TEST][listEmpty] Assertions passed. Test finished.");

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/5]⎯

 FAIL  tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdio
Integration) > should start 
a simple process and receive confirmation
                            AssertionError: expected undefined to be 'test-proce
ss-1746139854851' // Object.is equality

- Expected: 
"test-process-1746139854851"

+ Received: 
undefined

 ❯ tests/integration/mcp-server.test.ts:531:31
    529|    expect(startResult).not.toBeNull();
    530|    if (startResult) {
    531|     expect(startResult.label).toBe(uniqueLabel);
       |                               ^
    532|     expect(["running", "stopped"]).toContain(startResult.status);
    533|    }

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/5]⎯

 FAIL  tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdio
Integration) > should list o
ne running process after starting it
                            AssertionError: expected { processList: [ { …(12) },
 …(1) ] } to be an instance of Array
 ❯ tests/integration/mcp-server.test.ts:634:23
    632|    }
    633| 
    634|    expect(listResult).toBeInstanceOf(Array);
       |                       ^
    635|    // Check that the list contains at least the process we just started
    636|    expect(listResult?.length).toBeGreaterThanOrEqual(1);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/5]⎯

 FAIL  tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdio
Integration) > should restar
t a running process
                            TypeError: actual value must be number or bigint, re
ceived "undefined"
 ❯ tests/integration/mcp-server.test.ts:825:23
    823|    ) as ProcessStatusResult;
    824|    const initialPid = initialProcessInfo.pid;
    825|    expect(initialPid).toBeGreaterThan(0);
       |                       ^
    826|    console.log(`[TEST][restart] Initial PID: ${initialPid}`);
    827|    // --- End Process Start ---

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/5]⎯

 FAIL  tests/integration/mcp-server.test.ts > MCP Process Manager Server (Stdio
Integration) > should filter
 logs correctly on repeated checks of an active process
                            AssertionError: expected [ 'running', 'stopped' ] to
 include 'crashed'
 ❯ tests/integration/mcp-server.test.ts:1016:35
    1014| 
    1015|    // --> FIX: Allow 'running' or 'stopped' for first check
    1016|    expect(["running", "stopped"]).toContain(result1.status);
       |                                   ^
    1017|    expect(result1.label).toBe(label);
    1018|    expect(result1.command).toBe("node");

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/5]⎯


 Test Files  1 failed (1)
      Tests  5 failed | 2 passed (7)
   Start at  16:50:54
   Duration  16.39s (transform 43ms, setup 0ms, collect 43ms, tests 16.19s, envi
ronment 0ms, prepare 30ms)

 ELIFECYCLE  Test failed. See above for more details.

```

---

The tests failed. It seems the structure of the responses from the tools (`start_process`, `list_processes`) has changed or is being parsed incorrectly by the tests.

Looking at the failures:
1.  `should list zero processes initially`: Expected `processList: []` to be an instance of Array. The response is likely an object `{"processList": []}` instead of just the array.
2.  `should start a simple process`: Expected `startResult.label` to be the unique label, but `startResult.label` is undefined. The response format for `start_process` might have changed. The logs show the tool returning `{"result":{"isError":true,"content":[{"type":"text","text":"{\"error\": \"Tool execution failed: line.trim is not a function\"}"}]}}`. This indicates an internal error in the `start_process` implementation, possibly related to log handling or PTY output processing.
3.  `should list one running process`: Similar to the first failure, expecting an Array but likely getting an object.
4.  `should restart a running process`: `initialProcessInfo.pid` is undefined, leading to a TypeError. This likely stems from the same `start_process` issue seen in failure #2.
5.  `should filter logs correctly`: Expected status to be 'running' or 'stopped' but got 'crashed'. This also points back to the `start_process` failure causing the process to crash or be marked as crashed unexpectedly.

The core issue seems to be the `line.trim is not a function` error within the `start_process` tool implementation, likely triggered by the fast mode changes affecting timing or log processing.

I need to investigate the `start_process` implementation, specifically where it processes log lines, likely in `src/processLogic.ts` or `src/toolImplementations.ts`.

Let's examine `src/processLogic.ts` first, as it handles the core spawning and log management logic.

---

Read file: src/processLogic.ts

---

The error `line.trim is not a function` likely happens when processing data from the spawned process's stdout or stderr. The relevant code is likely within the `handleData` function or potentially the `spawnPtyProcess` function in `src/ptyManager.ts` where the listeners might be attached.

Let's look at the `handleData` function at the end of `src/processLogic.ts` (around line 871).

---

Read file: src/processLogic.ts

---

